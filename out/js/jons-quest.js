/* SAT.js - Version 0.6.0 - Copyright 2012 - 2016 - Jim Riecken <jimr@jimr.ca> - released under the MIT License. https://github.com/jriecken/sat-js */
function x(){function c(a,e){this.x=a||0;this.y=e||0}function B(a,e){this.pos=a||new c;this.r=e||0}function n(a,e){this.pos=a||new c;this.angle=0;this.offset=new c;this.u(e||[])}function q(a,e,b){this.pos=a||new c;this.w=e||0;this.h=b||0}function w(){this.b=this.a=null;this.overlapN=new c;this.overlapV=new c;this.clear()}function C(a,e,b){for(var h=Number.MAX_VALUE,c=-Number.MAX_VALUE,k=a.length,g=0;g<k;g++){var d=a[g].f(e);d<h&&(h=d);d>c&&(c=d)}b[0]=h;b[1]=c}function y(a,e,b,h,c,k){var g=r.pop(),
d=r.pop();a=m.pop().c(e).sub(a);e=a.f(c);C(b,c,g);C(h,c,d);d[0]+=e;d[1]+=e;if(g[0]>d[1]||d[0]>g[1])return m.push(a),r.push(g),r.push(d),!0;k&&(g[0]<d[0]?(k.aInB=!1,g[1]<d[1]?(b=g[1]-d[0],k.bInA=!1):(b=g[1]-d[0],h=d[1]-g[0],b=b<h?b:-h)):(k.bInA=!1,g[1]>d[1]?(b=g[0]-d[1],k.aInB=!1):(b=g[1]-d[0],h=d[1]-g[0],b=b<h?b:-h)),h=Math.abs(b),h<k.overlap&&(k.overlap=h,k.overlapN.c(c),0>b&&k.overlapN.reverse()));m.push(a);r.push(g);r.push(d);return!1}function z(a,e){var b=a.g(),c=e.f(a);return 0>c?-1:c>b?1:0}
function D(a,e,b){for(var c=m.pop().c(e.pos).sub(a.pos),l=e.r,k=l*l,g=a.calcPoints,d=g.length,u=m.pop(),f=m.pop(),n=0;n<d;n++){var v=n===d-1?0:n+1,r=0===n?d-1:n-1,q=0,t=null;u.c(a.edges[n]);f.c(c).sub(g[n]);b&&f.g()>k&&(b.aInB=!1);var p=z(u,f);if(-1===p){u.c(a.edges[r]);v=m.pop().c(c).sub(g[r]);p=z(u,v);if(1===p){p=f.j();if(p>l)return m.push(c),m.push(u),m.push(f),m.push(v),!1;b&&(b.bInA=!1,t=f.normalize(),q=l-p)}m.push(v)}else if(1===p){if(u.c(a.edges[v]),f.c(c).sub(g[v]),p=z(u,f),-1===p){p=f.j();
if(p>l)return m.push(c),m.push(u),m.push(f),!1;b&&(b.bInA=!1,t=f.normalize(),q=l-p)}}else{v=u.m().normalize();p=f.f(v);r=Math.abs(p);if(0<p&&r>l)return m.push(c),m.push(v),m.push(f),!1;b&&(t=v,q=l-p,0<=p||q<2*l)&&(b.bInA=!1)}t&&b&&Math.abs(q)<Math.abs(b.overlap)&&(b.overlap=q,b.overlapN.c(t))}b&&(b.a=a,b.b=e,b.overlapV.c(b.overlapN).scale(b.overlap));m.push(c);m.push(u);m.push(f);return!0}function E(a,e,b){for(var c=a.calcPoints,l=c.length,k=e.calcPoints,g=k.length,d=0;d<l;d++)if(y(a.pos,e.pos,c,
k,a.normals[d],b))return!1;for(d=0;d<g;d++)if(y(a.pos,e.pos,c,k,e.normals[d],b))return!1;b&&(b.a=a,b.b=e,b.overlapV.c(b.overlapN).scale(b.overlap));return!0}var f={};f.Vector=c;f.V=c;c.prototype.copy=c.prototype.c=function(a){this.x=a.x;this.y=a.y;return this};c.prototype.clone=c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.perp=c.prototype.m=function(){var a=this.x;this.x=this.y;this.y=-a;return this};c.prototype.rotate=c.prototype.rotate=function(a){var e=this.x,b=this.y;
this.x=e*Math.cos(a)-b*Math.sin(a);this.y=e*Math.sin(a)+b*Math.cos(a);return this};c.prototype.reverse=c.prototype.reverse=function(){this.x=-this.x;this.y=-this.y;return this};c.prototype.normalize=c.prototype.normalize=function(){var a=this.j();0<a&&(this.x/=a,this.y/=a);return this};c.prototype.add=c.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};c.prototype.sub=c.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};c.prototype.scale=c.prototype.scale=function(a,e){this.x*=
a;this.y*=e||a;return this};c.prototype.project=c.prototype.o=function(a){var e=this.f(a)/a.g();this.x=e*a.x;this.y=e*a.y;return this};c.prototype.projectN=c.prototype.s=function(a){var e=this.f(a);this.x=e*a.x;this.y=e*a.y;return this};c.prototype.reflect=function(a){var e=this.x,b=this.y;this.o(a).scale(2);this.x-=e;this.y-=b;return this};c.prototype.reflectN=function(a){var e=this.x,b=this.y;this.s(a).scale(2);this.x-=e;this.y-=b;return this};c.prototype.dot=c.prototype.f=function(a){return this.x*
a.x+this.y*a.y};c.prototype.len2=c.prototype.g=function(){return this.f(this)};c.prototype.len=c.prototype.j=function(){return Math.sqrt(this.g())};f.Circle=B;B.prototype.getAABB=function(){var a=this.r,e=this.pos.clone().sub(new c(a,a));return(new q(e,2*a,2*a)).l()};f.Polygon=n;n.prototype.setPoints=n.prototype.u=function(a){if(!this.points||this.points.length!==a.length){var e,b=this.calcPoints=[],h=this.edges=[],l=this.normals=[];for(e=0;e<a.length;e++)b.push(new c),h.push(new c),l.push(new c)}this.points=
a;this.i();return this};n.prototype.setAngle=function(a){this.angle=a;this.i();return this};n.prototype.setOffset=function(a){this.offset=a;this.i();return this};n.prototype.rotate=n.prototype.rotate=function(a){for(var e=this.points,b=e.length,c=0;c<b;c++)e[c].rotate(a);this.i();return this};n.prototype.translate=n.prototype.translate=function(a,c){for(var b=this.points,h=b.length,l=0;l<h;l++)b[l].x+=a,b[l].y+=c;this.i();return this};n.prototype.i=function(){var a=this.calcPoints,c=this.edges,b=
this.normals,h=this.points,l=this.offset,k=this.angle,g=h.length,d;for(d=0;d<g;d++){var f=a[d].c(h[d]);f.x+=l.x;f.y+=l.y;0!==k&&f.rotate(k)}for(d=0;d<g;d++)h=a[d],h=c[d].c(d<g-1?a[d+1]:a[0]).sub(h),b[d].c(h).m().normalize()};n.prototype.getAABB=function(){for(var a=this.calcPoints,e=a.length,b=a[0].x,h=a[0].y,f=a[0].x,k=a[0].y,g=1;g<e;g++){var d=a[g];d.x<b?b=d.x:d.x>f&&(f=d.x);d.y<h?h=d.y:d.y>k&&(k=d.y)}return(new q(this.pos.clone().add(new c(b,h)),f-b,k-h)).l()};f.Box=q;q.prototype.toPolygon=q.prototype.l=
function(){var a=this.pos,e=this.w,b=this.h;return new n(new c(a.x,a.y),[new c,new c(e,0),new c(e,b),new c(0,b)])};f.Response=w;w.prototype.clear=w.prototype.clear=function(){this.bInA=this.aInB=!0;this.overlap=Number.MAX_VALUE;return this};for(var m=[],t=0;10>t;t++)m.push(new c);for(var r=[],t=0;5>t;t++)r.push([]);var A=new w,F=(new q(new c,1E-6,1E-6)).l();f.isSeparatingAxis=y;f.pointInCircle=function(a,c){var b=m.pop().c(a).sub(c.pos),h=c.r*c.r,f=b.g();m.push(b);return f<=h};f.pointInPolygon=function(a,
c){F.pos.c(a);A.clear();var b=E(F,c,A);b&&(b=A.aInB);return b};f.testCircleCircle=function(a,c,b){var f=m.pop().c(c.pos).sub(a.pos),l=a.r+c.r,k=f.g();if(k>l*l)return m.push(f),!1;b&&(k=Math.sqrt(k),b.a=a,b.b=c,b.overlap=l-k,b.overlapN.c(f.normalize()),b.overlapV.c(f).scale(b.overlap),b.aInB=a.r<=c.r&&k<=c.r-a.r,b.bInA=c.r<=a.r&&k<=a.r-c.r);m.push(f);return!0};f.testPolygonCircle=D;f.testCirclePolygon=function(a,c,b){if((a=D(c,a,b))&&b){c=b.a;var f=b.aInB;b.overlapN.reverse();b.overlapV.reverse();
b.a=b.b;b.b=c;b.aInB=b.bInA;b.bInA=f}return a};f.testPolygonPolygon=E;return f}"function"===typeof define&&define.amd?define(x):"object"===typeof exports?module.exports=x():this.SAT=x();
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function StartScreen(){this.width=FULLW,level.isCutscene=!0}function Level3(){this.init()}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),utils=function(){var a;return{extend:function(a,b){$.extend(a,b);var c="imgReady";Object.defineProperty(a,c,{get:function(){return b[c]}})},speed2scale:function(a){return-.5*a+2},randF:function(a,b,c){return"undefined"==typeof c&&(c=2),parseFloat(Math.min(a+Math.random()*(b-a),b).toFixed(c))},repeatAction:function(a,b,c){var d=0,e=setInterval(function(){d++>b?clearInterval(e):c()},a)},deathSequence:function(){game.over||(game.over=!0,audio.heroDeath.play(),audio.bgMusic.muted=!0,setTimeout(function(){Graphics.fadeCanvas(function(){hero.lives-1<0?(alert("You Lose"),location.reload()):--hero.lives,level.reset(),level.curLvl.deinit(),level.curLvl.init(),audio.isOn&&(audio.bgMusic.muted=!1)})},2600))},degToRad:function(a){return.017453292519943295*a},revFactorial:function(a){for(var b=2,c=a;1!==c;){if(c/=b,0===c)return-1;if(1===c)return b;++b}},getTimeObj:function(a){if(0===a)return{min:"00",sec:"00"};var b=Math.floor(a/60),c=a%60;return c<10&&(c="0"+c),b<10&&(b="0"+b),{min:b,sec:c}},browser:function(){var a=navigator.userAgent,b=void 0,c=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(c[1])?(b=/\brv[ :]+(\d+(\.\d+)?)/g.exec(a)||[],"IE "+(b[1]||"")):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(b=a.match(/version\/([\.\d]+)/i))&&(c[2]=b[1]),c.join(" "))},printSlow:function(a){game.actualTime%10===0},printMouse:function(){$("canvas").on("mousemove",function(a){})},printDir:function(a){switch(a){case 0:break;case 1:break;case 2:break;case 3:break;case 4:break;case 5:}},toggleMenu:function(){"block"===$("#colorbox").css("display")?a.colorbox.close():a=$.colorbox({html:document.querySelector(".gameInstructions").innerHTML,width:320,height:530})},toggleFullScreen:function(){if(document.body.classList.contains("fullscreen"))$(".canvasWrap").css({width:"",marginLeft:""}),document.body.classList.remove("fullscreen");else{document.body.classList.add("fullscreen");var a=1.777778*$(window).height();$(".canvasWrap").css({width:a,marginLeft:-a/2})}}}}(),Dir=Object.freeze({NONE:0,TOP:1,BOT:2,LEFT:3,RIGHT:4,IN:5,UP:6,DOWN:7,UP_RIGHT:8,DOWN_RIGHT:9}),Color=Object.freeze({LIGHT_BROWN:"#c44525",DARK_BROWN:"#672819",LIGHT_GREEN:"#166a38",SILVER:"#c0c0c0",BLACK:"#000",GOLD:"#ddaa13",ORANGE:"#ff6a00"}),GameAudio=function(){function a(){var b=this;_classCallCheck(this,a),this.bgMusic=new Audio("audio/firstChiptune/firstChiptune.mp3"),this.bgMusic.loop=!0,this.bgMusic.volume=.7,this.bgMusic.pause(),this.enemyDeath=new Audio("audio/death.mp3"),this.enemyDeath.volume=.6,this.jump=new Audio("audio/jump.mp3"),this.jump.volume=.4,this.thud=new Audio("audio/thud.mp3"),this.thud.volume=.78,this.discovery=new Audio("audio/spell3.mp3"),this.discovery.volume=.7,this.enterSound=new Audio("audio/synthetic_explosion_1.mp3"),this.exitSound=new Audio("audio/annulet.mp3"),this.itemPickedUp=new Audio("audio/life_pickup.mp3"),this.heartbeat=new Audio("audio/heartbeat.mp3"),this.step=new Audio("audio/step.mp3"),this.effort=new Audio("audio/woosh.mp3"),this.heroDeath=new Audio("audio/DiscsOfTron_Cascade.mp3"),this.enchant=new Audio("audio/enchant.mp3"),this.isOn=!1,this.mute(!0),$(document).on("click",".audioState",function(){b.handleMuteButton()}),document.querySelector(".menu").addEventListener("click",function(a){a.preventDefault(),utils.toggleMenu()})}return _createClass(a,[{key:"lvlComplete",value:function(){var a=this;this.bgMusic.pause();var b=void 0;switch(game.lvl){case 0:return void this.enterSound.play();default:this.exitSound.play(),b="sweetAcoustic.mp3"}setTimeout(function(){a.bgMusic=new Audio("audio/"+b),a.bgMusic.loop=!0,a.bgMusic.volume=.45,a.isOn?a.bgMusic.play():a.bgMusic.pause()},1e3)}},{key:"updateBgMusic",value:function(){var a=this;this.bgMusic.pause();var b=void 0;switch(game.lvl){case 1:case 2:b="inspiredBySparkMan/sparkBoy.mp3";break;case 3:b="bossBeat/bossBeat.mp3";break;default:b="sweetAcoustic.mp3"}setTimeout(function(){a.bgMusic=new Audio("audio/"+b),a.bgMusic.loop=!0,a.bgMusic.volume=.45,a.isOn?a.bgMusic.play():a.bgMusic.pause()},1e3)}},{key:"play",value:function(a,b){b="undefined"==typeof b||b,a.ended?a.play():(b||0===a.currentTime)&&(a.pause(),a.currentTime=0,a.play())}},{key:"handleMuteButton",value:function(){var a=document.querySelector(".audioState");a.classList.contains("off")?($(".audioState iron-icon").attr("icon","av:volume-up"),a.classList.remove("off"),a.classList.add("on"),this.mute(!1)):($(".audioState iron-icon").attr("icon","av:volume-off"),a.classList.remove("on"),a.classList.add("off"),this.mute(!0))}},{key:"mute",value:function(a){this.discovery.muted=this.enterSound.muted=this.bgMusic.muted=this.itemPickedUp.muted=this.heartbeat.muted=this.effort.muted=this.thud.muted=this.jump.muted=this.step.muted=this.enemyDeath.muted=this.heroDeath.muted=this.enchant.muted=this.exitSound.muted=a,a?this.bgMusic.pause():this.bgMusic.play(),this.isOn=!a}}]),a}(),Graphics=function(){var a=1,b=null,c=250,d=c,e=c,f=170;return{ticker:1,tickerStep:.01,fadeOut:!1,projectX:8,projectY:11,fadeCanvas:function(a){"MSIE 9.0"===utils.browser()?a():($(canvas).removeClass("preTransition"),$(canvas).addClass("duringTransition"),b=$(canvas).on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){b.off(),$(this).removeClass("duringTransition"),$(this).addClass("preTransition"),a()}))},blinkText:function(b,c,d,e){e="undefined"!=typeof e?e:"PRESS ENTER",(Graphics.ticker>=1.35||Graphics.ticker<=Graphics.tickerStep)&&(Graphics.fadeOut=!Graphics.fadeOut),a=Graphics.ticker>=1?1:Graphics.ticker<=Graphics.tickerStep?0:Graphics.ticker,ctx.font=b+'px "Press Start 2P"';var f=ctx.measureText(e).width;ctx.fillStyle="rgba(233, 233, 233, "+a+")",ctx.fillText(e,c-f/2,d)},getSkewedRect:function(a,b,c,d){b+=Graphics.projectY/2;var e=new SAT.Polygon(new SAT.Vector(a,b),[new SAT.Vector,new SAT.Vector(c-Graphics.projectX,0),new SAT.Vector(c,Graphics.projectY),new SAT.Vector(c,d),new SAT.Vector(Graphics.projectX,d),new SAT.Vector(0,d-Graphics.projectY)]);return e},getStairPoly:function(a,b,c,d,e){var f;return f=e===Dir.UP_RIGHT?new SAT.Polygon(new SAT.Vector(a,b),[new SAT.Vector,new SAT.Vector(c-Graphics.projectX,-d),new SAT.Vector(c,-d+Graphics.projectY),new SAT.Vector(c,0),new SAT.Vector(Graphics.projectX,d),new SAT.Vector(0,d-Graphics.projectY)]):new SAT.Polygon(new SAT.Vector(a,b),[new SAT.Vector,new SAT.Vector(c-Graphics.projectX,d-Graphics.projectY-5),new SAT.Vector(c,d-4),new SAT.Vector(0,d),new SAT.Vector(Graphics.projectX,d),new SAT.Vector(0,d-Graphics.projectY)])},setClouds:function(a){for(var b=0;b<a;)b=Graphics.spawnCloud(b)},spawnCloud:function(a){var b=Math.floor(Math.random()*f),c=utils.randF(2,3.3,1),d=120*utils.speed2scale(c);a+=d+Math.floor(20*Math.random()+8);var e=new GameObj(JQObject.CLOUD,a,10+b,0,0,"cloud.png");return e.speed=c,e.distTraveled=0,e.distToTravel=a+d,level.bg.push(e),a},drawLadder:function(a){var b=a.pos.x,c=a.pos.y,d=a.edges[0].x,e=a.edges[1].y;ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(b,c,5,e),ctx.fillRect(b+d-5,c,5,e);for(var f=13;f<e;f+=20)ctx.fillRect(b,c+f,d,8)},getScale:function(a,b){for(var c={},d=0;d<2;++d){var e=0===d?Dir.LEFT:Dir.RIGHT;c[e]=new GameObj(JQObject.SCALE,a+300*d,b,150,46),c[e].holdingItem=null}return c.vBar=new GameObj(JQObject.SCALEBG,c[Dir.LEFT].pos.x+c[Dir.LEFT].w+70,HALFH-game.padFloor,10,HALFH),c.vBar.collidable=!1,c.hBar=new GameObj(JQObject.SCALEBG,c[Dir.LEFT].pos.x+c[Dir.LEFT].w/2,HALFH,300,10),c.hBar.x2=c.hBar.pos.x+c.hBar.w,c.hBar.y2=c.hBar.pos.y,c.hBar.collidable=!1,c.hBar.visible=!1,c[Dir.LEFT].hBar=c.hBar,c[Dir.LEFT].side=Dir.LEFT,c[Dir.LEFT].otherSide=c[Dir.RIGHT],c[Dir.RIGHT].hBar=c.hBar,c[Dir.RIGHT].side=Dir.RIGHT,c[Dir.RIGHT].otherSide=c[Dir.LEFT],c},drawScale:function(a){var b=a.pos.x,c=a.pos.y,d=a.edges[0].x,e=a.edges[1].y;ctx.fillStyle=Color.BLACK,ctx.fillRect(b,c-1,d,1),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(b,c,d,e)},drawScaleChains:function(a,b,c){ctx.beginPath(),ctx.moveTo(a,b),ctx.lineTo(c.pos.x,c.pos.y),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(a,b),ctx.lineTo(c.pos.x+c.w/2,c.pos.y),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(a,b),ctx.lineTo(c.pos.x+c.w,c.pos.y),ctx.stroke(),ctx.closePath()},drawScaleBg:function(a){ctx.strokeStyle="#000",ctx.lineWidth=10,ctx.beginPath(),ctx.moveTo(a.hBar.pos.x,a.hBar.pos.y),ctx.lineTo(a.hBar.x2,a.hBar.y2),ctx.stroke(),ctx.closePath(),Graphics.drawScaleChains(a.hBar.pos.x,a.hBar.pos.y,a[Dir.LEFT]),Graphics.drawScaleChains(a.hBar.x2,a.hBar.y2,a[Dir.RIGHT])},drawPoly:function(a,b,c){var d=a.pos.y-Graphics.projectY,e=a.pos.x;"undefined"!=typeof c&&(e+=c.x,d+=c.y),ctx.fillStyle="undefined"!=typeof b?b:"orange",ctx.beginPath(),ctx.moveTo(e,d);var f=!0,g=!1,h=void 0;try{for(var i,j=a.points[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value;ctx.lineTo(e+k.x,d+k.y)}}catch(a){g=!0,h=a}finally{try{!f&&j.return&&j.return()}finally{if(g)throw h}}ctx.closePath(),ctx.fill()},drawHill:function(a){for(var b=0;b<game.padFloor-15;++b)Graphics.drawPoly(a,Color.LIGHT_BROWN,{x:0,y:b});Graphics.drawPoly(a,Color.DARK_BROWN,{x:Graphics.projectX,y:game.padFloor})},getHill:function(a,b,c,d){var e=[new SAT.V];a+=c/2,b+=Graphics.projectY;for(var f,g,h=c/2,i=d/2,j=180;360!==j;)f=h*Math.cos(utils.degToRad(j)),g=i*Math.sin(utils.degToRad(j++)),e.push(new SAT.V(f,g));return e.push(new SAT.V(c/2)),new SAT.Polygon(new SAT.V(a,b),e)},drawPlatform:function(a){var b=a.pos.y-Graphics.projectY/2;ctx.fillStyle=Color.LIGHT_BROWN,ctx.beginPath(),ctx.moveTo(a.pos.x,b),ctx.lineTo(a.pos.x+a.points[1].x,b+a.points[1].y),ctx.lineTo(a.pos.x+a.points[2].x,b+a.points[2].y),ctx.lineTo(a.pos.x+Graphics.projectX,b+Graphics.projectY),ctx.closePath(),ctx.fill(),ctx.fillStyle=Color.DARK_BROWN,ctx.beginPath(),ctx.moveTo(a.pos.x+a.points[2].x,b+a.points[2].y),ctx.lineTo(a.pos.x+a.points[3].x,b+a.points[3].y),ctx.lineTo(a.pos.x+a.points[4].x,b+a.points[4].y),ctx.lineTo(a.pos.x+a.points[5].x,b+a.points[5].y),ctx.lineTo(a.pos.x+a.points[0].x,b+a.points[0].y),ctx.lineTo(a.pos.x+Graphics.projectX,b+Graphics.projectY),ctx.closePath(),ctx.fill()},drawPlatformStatus:function(a){var b=a.pos.x,c=a.pos.y,d=a.w,e=a.h,f=26,g=f/2,h=b+d/2-g,i=c+e/2-g;ctx.lineWidth=3,null!==a.holdingItem&&a.holdingItem.type===JQObject.CRATE?(ctx.strokeStyle="green",--i,ctx.beginPath(),ctx.moveTo(h,i+g),ctx.lineTo(h+g,i+f),ctx.moveTo(h+g-1,i+f),ctx.lineTo(h+f+2,i+2),ctx.stroke(),ctx.closePath()):(ctx.strokeStyle="red",ctx.beginPath(),ctx.moveTo(h,i),ctx.lineTo(h+f,i+f),ctx.moveTo(h,i+f),ctx.lineTo(h+f,i),ctx.stroke(),ctx.closePath())},drawDoor:function(a){var b=a.pos.x,c=a.pos.y,d=a.w,e=a.h;ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(b+2,c+2,d-2,e-2),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(b,c,2,e),ctx.fillRect(b,c,d,2),ctx.fillRect(b+d,c,2,e),ctx.beginPath(),ctx.arc(b+d-d/3.2,c+e-e/3.4,4,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.font="19px 'Press Start 2P'",ctx.fillStyle=Color.DARK_BROWN,ctx.fillText("EXIT",b-15,c-3),ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillText("EXIT",b-18,c-5)},getDoorBgGrad:function(){var a=ctx.createRadialGradient(level.bgColor.gradX,level.bgColor.gradY,14,level.bgColor.gradX,level.bgColor.gradY,490-e);return--d===-c?(d=c,e=c):d<0?++e:--e,a.addColorStop(0,level.bgColor.c0),a.addColorStop(1,level.bgColor.c1),a},drawEllipse:function(a,b,c,d){var e=.5522848,f=c/2*e,g=d/2*e,h=a+c,i=b+d,j=a+c/2,k=b+d/2;ctx.beginPath(),ctx.moveTo(a,k),ctx.bezierCurveTo(a,k-g,j-f,b,j,b),ctx.bezierCurveTo(j+f,b,h,k-g,h,k),ctx.bezierCurveTo(h,k+g,j+f,i,j,i),ctx.bezierCurveTo(j-f,i,a,k+g,a,k),ctx.closePath(),ctx.fill()},drawRotate:function(a,b,c,d){ctx.save(),ctx.translate(b,c),ctx.rotate(utils.degToRad(d)),ctx.translate(.5*-a.width,.5*-a.height),ctx.drawImage(a,0,0),ctx.restore()}}}(),Physics=function(){return{isCollision:function(a,b,c,d){var e="undefined"!=typeof d?a.pos.x+a.lvlX:a.pos.x;return e+c<=b.pos.x+b.w&&b.pos.x+c<=e+a.w&&a.pos.y+c<=b.pos.y+b.h&&b.pos.y+c<=a.pos.y+a.h},isSATcollision:function(a,b,c){var d=new SAT.Response;SAT.testPolygonPolygon(a,b,d)&&c(d)},testObjObjs:function(a,b){for(var c=new SAT.Response,d=0;d<level.objs.length;++d){var e=level.objs[d];if("undefined"==typeof e.collidable){var f=SAT.testPolygonPolygon(a,e,c);f&&b(c),c.clear()}}},testItemItems:function(a,b){for(var c=new SAT.Response,d=0;d<level.items.length;++d)if(!level.items[d].isBeingHeld){if(level.items[d].type!==JQObject.CRATE)continue;var e=SAT.testPolygonPolygon(a,level.items[d],c);if(e&&1===c.overlapN.y){c.a.pos.x-=c.overlapV.x,c.a.pos.y-=c.overlapV.y,b(c);break}c.clear()}},testHeroItems:function(a){for(var b=0;b<level.items.length;++b)level.items[b].visible&&Physics.isSATcollision(hero,level.items[b],function(c){a(c,b)})},handleScale:function(){for(var a=0,b=0;b<level.objs.length;++b)level.objs[b].type===JQObject.SCALE&&"undefined"!=typeof level.objs[b].holdingItem&&null!==level.objs[b].holdingItem&&level.objs[b].holdingItem.type===JQObject.CRATE&&++a;var c=2===a;if(c){audio.discovery.play();var d=$.grep(level.objs,function(a){return a.type===JQObject.LADDER});d[0].visible=!0}return c}}}(),JQObject=Object.freeze({EMPTY:0,CRATE:1,LADDER:2,SACK:3,ENEMY:4,CASH:5,DOOR:6,SCALE:7,CLOUD:8,PLATFORM:9,SHURIKEN:10,SLOPE:11,POLY:12,HILL:13,ELEVATOR:14,SCALEBG:15,FIREBALL:16}),JQObject_names=Object.freeze({0:"EMPTY",1:"CRATE",2:"LADDER",3:"SACK",4:"ENEMY",5:"CASH",6:"DOOR",7:"SCALE",8:"CLOUD",9:"PLATFORM",10:"SHURIKEN",11:"SLOPE",12:"POLY",13:"HILL",14:"ELEVATOR",15:"SCALEBG",16:"FIREBALL"}),GameObj=function(a,b,c,d,e,f,g){if(this.dir=g,a===JQObject.PLATFORM||a===JQObject.ELEVATOR?$.extend(this,Graphics.getSkewedRect(b,c,d,e)):a===JQObject.SLOPE?$.extend(this,Graphics.getStairPoly(b,c,d,e,g)):a===JQObject.HILL?$.extend(this,Graphics.getHill(b,c,d,e)):a===JQObject.POLY||$.extend(this,new SAT.Box(new SAT.Vector(b,c),d,e).toPolygon()),this.type=a,this.imgReady=!1,"undefined"==typeof f||null===f)this.w=d,this.h=e;else{this.w=d,this.h=e,this.img=new Image;var h=this;this.img.onload=function(){h.imgReady=!0,h.w=this.width,h.h=this.height},this.img.src="img/"+f}};GameObj.prototype={draw:function(){this.imgReady?ctx.drawImage(this.img,this.pos.x,this.pos.y):(this.type===JQObject.SCALEBG?ctx.fillStyle=Color.LIGHT_BROWN:this.type===JQObject.FIREBALL?ctx.fillStyle="orange":ctx.fillStyle="red",ctx.fillRect(this.pos.x,this.pos.y,this.w,this.h))}};var GameItem=function(a,b,c,d){utils.extend(this,a),this.grabbable="undefined"!=typeof b&&b,this.val="undefined"!=typeof c?c:-1,this.visible="undefined"==typeof d||d,this.vY=0,this.isOnObj=!1,this.onObj=null,this.isBeingHeld=!1;var e=this.draw;this.draw=function(){this.visible&&e.apply(this)}},Hud=function(){function a(){_classCallCheck(this,a),this.cash=new GameObj(JQObject.EMPTY,548,FULLH+20,22,24,"cash.png"),this.medKit=new GameObj(JQObject.EMPTY,238,FULLH+15,31,30,"medKit.png"),this.shuriken=new GameObj(JQObject.EMPTY,447,FULLH+15,31,31,"shuriken.png"),this.syringe=new GameObj(JQObject.EMPTY,342,FULLH+18,25,25,"syringe.png")}return _createClass(a,[{key:"drawHealth",value:function(){for(var a=0;a<hero.health;++a)ctx.fillStyle="red",ctx.fillRect(77+21*a,FULLH+8,19,8)}},{key:"drawMana",value:function(){for(var a=0;a<hero.mana;++a)ctx.fillStyle="#00b6ff",ctx.fillRect(77+21*a,FULLH+26,19,8)}},{key:"drawXP",value:function(){ctx.fillStyle="#ddd",ctx.font='12px "Press Start 2P"';var a=hero.xp<10?"0":"";ctx.fillText(""+a+hero.xp+"/"+hero.xpNeeded,77,FULLH+54)}},{key:"draw",value:function(){ctx.fillStyle="#070707",ctx.fillRect(0,FULLH,FULLW,game.padHUD),ctx.fillStyle="#ddd",ctx.font='11px "Press Start 2P"',ctx.fillText("HP-"+hero.healthLvl,7,FULLH+18),ctx.fillText("MP-"+hero.manaLvl,7,FULLH+37),ctx.fillText("XP",7,FULLH+54),this.drawHealth(),this.drawMana(),this.drawXP(),ctx.fillText(hero.medKits,210,FULLH+37),this.medKit.draw(),ctx.fillText(hero.manaKits,315,FULLH+37),this.syringe.draw(),ctx.fillText(hero.ammo,410,FULLH+37),this.shuriken.draw(),ctx.fillText(hero.cash,515,FULLH+37),this.cash.draw(),ctx.fillText("LIVES x"+hero.lives,700,FULLH+37);var a=utils.getTimeObj(game.actualTime);ctx.fillText(a.min+":"+a.sec,FULLW-78,FULLH+24)}}]),a}(),JQEnemy=Object.freeze({STILL:0,PATROL:1,FOLLOW:2}),Enemy=function(a,b,c,d,e,f){function g(){var a=h.w/h.initHealth*h.health;ctx.fillStyle="red",ctx.fillRect(h.pos.x,h.pos.y-12,a,4)}utils.extend(this,a),this.initX=this.pos.x,this.initY=this.pos.y,this.initHealth=this.health=c,this.enemy_t=b,this.leftXBound=d,this.rightXBound=e,this.active="undefined"!=typeof f&&f,this.deadOffScreen=!1,this.dir=Dir.RIGHT,this.alive=!0,this.deadOnScreen=!1,this.clearDir=Dir.RIGHT;var h=this,i=this.draw;this.draw=function(){(this.alive||this.deadOnScreen)&&(this.initHealth>1&&g(),ctx.save(),this.deadOnScreen&&(ctx.globalAlpha=.3),i.apply(this),ctx.restore())}};Enemy.prototype={update:function(){this.deadOnScreen?this.enemy_t===JQEnemy.STILL?(this.deadOnScreen=!1,this.deadOffScreen=!0):(this.pos.x+=this.clearDir===Dir.RIGHT?2:-2,this.pos.y-=9,(this.pos.x<0||this.pos.x>FULLW)&&(this.deadOnScreen=!1,this.deadOffScreen=!0)):this.active&&game.totalTicks%3===0&&this.movement()},movement:function(){this.enemy_t===JQEnemy.PATROL?(this.pos.x+hero.lvlX<=this.leftXBound?this.dir=Dir.RIGHT:this.pos.x+hero.lvlX>=this.rightXBound&&(this.dir=Dir.LEFT),this.dir===Dir.RIGHT?++this.pos.x:--this.pos.x):this.enemy_t===JQEnemy.FOLLOW&&(this.pos.x<hero.pos.x?++this.pos.x:this.pos.x>hero.pos.x&&--this.pos.x)},death:function(){this.clearDir=hero.dir,audio.enemyDeath.play(),hero.xp+=15,this.alive=!1,this.deadOnScreen=!0},revive:function(){this.health=this.initHealth,this.deadOffScreen=!1,this.deadOnScreen=!1,this.alive=!0}};var level=function(){function a(){for(var a=0;a<level.objs.length;++a)level.objs[a].pos.x-=hero.vX,level.objs[a].type===JQObject.SCALEBG&&(level.objs[a].x2-=hero.vX)}function b(){for(var a=0;a<level.items.length;++a)level.items[a].pos.x-=hero.vX}function c(){level.bgColor.gradX-=hero.vX,level.bgColor.fillStyle=Graphics.getDoorBgGrad();for(var a=0;a<level.bg.length;++a){var b=hero.vX/level.bg[a].speed;level.bg[a].pos.x-=b,level.bg[a].distTraveled+=b}}function d(){for(var a=0;a<level.enemies.length;++a)level.enemies[a].pos.x-=hero.vX}function e(){for(var a=0;a<level.items.length;++a)level.items[a].visible&&!level.items[a].isOnObj&&(level.items[a].vY<k?level.items[a].vY+=game.gravity:level.items[a].vY=k,Physics.testObjObjs(level.items[a],function(a){a.a.pos.x-=a.overlapV.x,a.a.pos.y-=a.overlapV.y,1===a.overlapN.y&&(audio.thud.play(),a.a.vY=a.b.type===JQObject.ELEVATOR?a.b.vY:0,a.a.isOnObj=!0,a.a.onObj=a.b,a.a.recentlyHeld=!1,a.b.type===JQObject.SCALE&&null===a.b.holdingItem&&(a.a.grabbable=!1,a.b.holdingItem=a.a,utils.repeatAction(42,14,function(){a.b.side===Dir.LEFT?(++a.a.pos.y,++a.b.pos.y,++a.b.hBar.pos.y,--a.b.otherSide.pos.y,--a.b.hBar.y2,null!==a.b.otherSide.holdingItem&&--a.b.otherSide.holdingItem.pos.y):(++a.a.pos.y,++a.b.pos.y,++a.b.hBar.y2,--a.b.hBar.pos.y,--a.b.otherSide.pos.y,null!==a.b.otherSide.holdingItem&&--a.b.otherSide.holdingItem.pos.y)})))}),Physics.testItemItems(level.items[a],function(a){a.a.isOnObj=!0,a.a.onObj=a.b,a.b.grabbable=!1,a.a.recentlyHeld=!1})),"undefined"!=typeof level.items[a].onObj&&null!==level.items[a].onObj&&(level.items[a].vY=level.items[a].onObj.type===JQObject.ELEVATOR?level.items[a].onObj.vY:0),level.items[a].pos.y+=level.items[a].vY}function f(){for(var a=0;a<level.enemies.length;++a)if(level.enemies[a].update(),level.enemies[a].health>0){SAT.testPolygonPolygon(hero,level.enemies[a])&&(level.enemies[a].active=!0,hero.invincible||(audio.play(audio.heartbeat,!0),hero.invincible=!0,--hero.health));for(var b=0;b<hero.bulletArr.length;++b)SAT.testPolygonPolygon(hero.bulletArr[b],level.enemies[a])&&(audio.play(audio.thud,!0),level.enemies[a].active=!0,hero.bulletArr.splice(b,1),--level.enemies[a].health,level.enemies[a].health<=0&&level.enemies[a].death())}}function g(){ctx.fillStyle="#000",ctx.fillRect(0,FULLH-game.padFloor,FULLW,game.padFloor),ctx.fillStyle=level.bgColor.fillStyle,ctx.fillRect(0,0,FULLW,FULLH-game.padFloor);for(var a=0;a<level.bg.length;++a){var b=level.bg[a],c=utils.speed2scale(b.speed);ctx.drawImage(b.img,b.pos.x,b.pos.y,b.w*c,b.h*c)}}function h(){for(var a=0;a<level.objs.length;++a){var b=level.objs[a];("undefined"==typeof b.visible||b.visible)&&(b.type===JQObject.LADDER?Graphics.drawLadder(b):b.type===JQObject.SCALE?(Graphics.drawScale(b),Graphics.drawPlatformStatus(b)):b.type===JQObject.PLATFORM||b.type===JQObject.SLOPE||b.type===JQObject.ELEVATOR?Graphics.drawPlatform(b):b.type===JQObject.DOOR?Graphics.drawDoor(b):b.type===JQObject.POLY?Graphics.drawPoly(b):b.type===JQObject.HILL?Graphics.drawHill(b):b.draw())}}function i(){for(var a=0;a<level.items.length;++a)level.items[a].draw()}function j(){for(var a=0;a<level.enemies.length;++a)level.enemies[a].deadOffScreen||level.enemies[a].draw()}var k=10;return{bgColor:{},bg:[],objs:[],items:[],enemies:[],curLvl:null,isCutscene:!1,time:0,hiddenItemsFound:0,hiddenItems:0,isTransitioning:!1,init:function(){level.reset(),level.curLvl=new StartScreen},reset:function(){game.over=!1,game.actualTime=0,level.hiddenItemsFound=0,hero.lvlX=0,level.bgColor={fillStyle:"#000"},level.bg=[],level.objs=[],level.items=[],level.enemies=[],hero.pos.x=23,hero.pos.y=FULLH-game.padFloor-hero.h+4,hero.vX=hero.vY=0,hero.isJumping=!1,hero.ammo=20,hero.bulletArr.length=0,hero.invincible=!1,hero.isHolding=!1,hero.curItem=null,hero.dir=Dir.RIGHT,hero.health=hero.maxHealth},complete:function(){level.isTransitioning=!0,audio.lvlComplete(),Graphics.ticker=1,Graphics.fadeOut=!0,Graphics.fadeCanvas(function(){level.isTransitioning=!1,level.curLvl=lvlComplete,level.isCutscene=!0,level.time=game.actualTime})},update:function(){if(!level.isTransitioning){if(0!=game.lvl){e(),f();for(var a=level.bg.length;a--;){var b=.5/level.bg[a].speed;level.bg[a].pos.x-=b,level.bg[a].distTraveled+=b,level.bg[a].distTraveled>level.bg[a].distToTravel&&(level.bg.splice(a,1),Graphics.spawnCloud(level.curLvl.width))}}level.curLvl.update()}},updateView:function(){a(),b(),c(),d()},render:function(){g(),h(),i(),j(),level.curLvl.render()}}}(),lvlComplete=function(){function a(a){lastKeyDown=KeyCode.EMPTY,level.reset(),null!=a?game.lvl=a:++game.lvl,b(game.lvl),level.isCutscene=!1}function b(a){switch(a){case 1:lvl1.init(),level.curLvl=lvl1;break;case 2:lvl2.init(),level.curLvl=lvl2;break;case 3:var b=new Level3;level.curLvl=b}audio.updateBgMusic()}return{update:function(){window.DEBUG?a(window.DEBUG_OPT.lvl):(keysDown[KeyCode.ENTER]||0===game.lvl)&&a()},render:function(){ctx.fillStyle="#000",ctx.fillRect(0,0,FULLW,canvas.height),ctx.font="24px 'Press Start 2P'";var a="LEVEL "+game.lvl+" COMPLETE",b=ctx.measureText(a).width;ctx.fillStyle=Color.ORANGE,ctx.fillText(a,HALFW-b/2,70),ctx.font="18px 'Press Start 2P'";var c=utils.getTimeObj(level.time),d="LEVEL TIME......"+c.min+":"+c.sec;ctx.measureText(d).width;ctx.fillStyle="#e1e1e1",ctx.fillText(d,HALFW-b/2,150),ctx.font="18px 'Press Start 2P'";var e="HIDDEN ITEMS....."+level.hiddenItemsFound+"/"+level.hiddenItems,f=ctx.measureText(e).width;ctx.fillStyle="#e1e1e1",ctx.fillText(e,HALFW-f/2,190),Graphics.blinkText(16,HALFW,HALFH+120)}}}();StartScreen.prototype=function(){var a="JON'S",b="QUEST",c=String.fromCharCode("169")+" 2017 JON WIEDMANN";return{update:function(){lastKeyDown===KeyCode.ENTER&&level.complete()},render:function(){ctx.font="29px 'Press Start 2P'";var d=HALFW-ctx.measureText(a).width/2+11,e=58;ctx.setTransform(1,0,-.4,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("J",d+4,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("J",d,e),ctx.setTransform(1,0,-.2,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("O",d+32,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("O",d+28,e),ctx.setTransform(1,0,.05,1.41,0,-1),ctx.fillStyle="#222",ctx.fillText("N",d+58,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("N",d+54,e),ctx.setTransform(1,0,.23,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("'",d+78,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("'",d+74,e),ctx.setTransform(1,0,.42,1.4,0,0),ctx.fillStyle="#222",ctx.fillText("S",d+95,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("S",d+91,e),ctx.font="36px 'Press Start 2P'",d=HALFW-ctx.measureText(b).width/2+30,e=98,ctx.setTransform(1,0,-.5,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("Q",d+4,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("Q",d,e),ctx.setTransform(1,0,-.25,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("U",d+26,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("U",d+22,e),ctx.setTransform(1,0,.03,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("E",d+50,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("E",d+46,e),ctx.setTransform(1,0,.25,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("S",d+74,e+3),ctx.fillStyle="#ff6a00",ctx.fillText("S",d+70,e),ctx.setTransform(1,0,.5,1.6,0,0),ctx.fillStyle="#222",ctx.fillText("T",d+90,e+4),ctx.fillStyle="#ff6a00",ctx.fillText("T",d+86,e),ctx.setTransform(1,0,0,1,0,0),Graphics.blinkText(22,HALFW,HALFH+81),ctx.fillStyle="#000",ctx.fillRect(0,FULLH,FULLW,game.padHUD),ctx.font="13px 'Press Start 2P'",ctx.fillStyle="#c9c9c9",ctx.fillText(c,HALFW-ctx.measureText(c).width/2,FULLH+24)}}}();var lvl1=function(){function a(){level.bgColor.gradX=f.pos.x+f.w/2,level.bgColor.gradY=f.pos.y+f.h/2,level.bgColor.c0="rgb(203,163,0)",level.bgColor.c1="#1F7DCF",level.bgColor.fillStyle=Graphics.getDoorBgGrad(),Graphics.setClouds(lvl1.width)}function b(){level.objs.push(new GameObj(JQObject.PLATFORM,-Graphics.projectX,FULLH-game.padFloor-1,lvl1.width+2*Graphics.projectX,game.padFloor+1),new GameObj(JQObject.PLATFORM,200,206,267,62),new GameObj(JQObject.PLATFORM,575,310,300,62),new GameObj(JQObject.PLATFORM,605,125,220,62)),i=Graphics.getScale(1500,FULLH-game.padFloor-137),level.objs.push(i.vBar,i.hBar,i[Dir.LEFT],i[Dir.RIGHT]);var a=new GameObj(JQObject.SLOPE,2203,208,252,62,null,Dir.UP_RIGHT),b=new GameObj(JQObject.PLATFORM,a.pos.x+a.w-11,a.pos.y-a.h-5,200,62);f=new GameObj(JQObject.DOOR,b.pos.x+b.w-63,b.pos.y-62-Graphics.projectY/2,33,62),level.objs.push(b,a,f),g=new GameItem(new GameObj(JQObject.LADDER,a.pos.x-37,a.pos.y-1,38,FULLH-a.pos.y-game.padFloor),!1,0,!1),g.collidable=!1,level.objs.push(g)}function c(){for(var a=[],b=0;b<3;++b)a.push(new GameItem(new GameObj(JQObject.CRATE,446,FULLH-game.padFloor-26+5,34,37,"crate.png"),!0));a[1].pos.x=i[Dir.LEFT].pos.x+i[Dir.LEFT].w/2-a[0].w/2,a[2].pos.x=i[Dir.RIGHT].pos.x+i[Dir.RIGHT].w/2-a[0].w/2;var c=new GameItem(new GameObj(JQObject.SACK,680,111+Graphics.projectY/2,30,34,"sack.png"),!1,5);e=new GameItem(new GameObj(JQObject.CASH,113,80,22,24,"cash.png"),!1,10,!1),level.items.push(a[0],a[1],a[2],c,e)}function d(){var a=new Enemy(new GameObj(JQObject.ENEMY,1200,FULLH-game.padFloor-55+Graphics.projectY/2,40,55,"cyborgBnW.png"),JQEnemy.FOLLOW,1,1087,1600,!1);a.collidable=!1,level.enemies.push(a)}var e,f,g,h=!1,i={};return{width:2710,init:function(){level.hiddenItems=1,b(),c(),d(),a()},deinit:function(){e=null,f=null,g=null,h=!1},update:function(){if(h?hero.onLadder=SAT.testPolygonPolygon(hero,g):h=Physics.handleScale(),!e.visible)for(var a=0;a<hero.bulletArr.length;++a)Physics.isCollision(hero.bulletArr[a],e,-17)&&(e.visible=!0,audio.discovery.play(),++level.hiddenItemsFound);!game.over&&Physics.isCollision(hero,f,0)&&level.complete()},render:function(){Graphics.drawScaleBg(i)}}}(),lvl2=function(){function a(){level.bgColor.gradX=p.pos.x,level.bgColor.gradY=p.pos.y,level.bgColor.c0="rgb(203,163,0)",level.bgColor.c1="#1F7DCF",level.bgColor.fillStyle=Graphics.getDoorBgGrad(),Graphics.setClouds(lvl2.width)}function b(){g=new GameObj(JQObject.PLATFORM,-Graphics.projectX,FULLH-game.padFloor,FULLW-250,game.padFloor),h=new GameObj(JQObject.HILL,200,FULLH-game.padFloor,320,60),i=new GameObj(JQObject.PLATFORM,g.pos.x+g.w-Graphics.projectX,g.pos.y-g.h-30,1e3,180),j=new GameObj(JQObject.PLATFORM,i.pos.x+240,i.pos.y-90+Graphics.projectY,100,85),k=new GameObj(JQObject.PLATFORM,i.pos.x+i.w-100,i.pos.y-90+Graphics.projectY,100,85),l=new GameObj(JQObject.PLATFORM,j.pos.x+140,j.pos.y-137,480,30),level.objs.push(i,g,h,j,k,l);for(var a=0;a<3;++a)s[a]=new GameObj(JQObject.ELEVATOR,k.pos.x+237+300*a,k.pos.y-80*a,115,26),s[a].dir=Dir.DOWN,level.objs.push(s[a]);m=new GameObj(JQObject.PLATFORM,s[2].pos.x+s[2].w+120,190,100,FULLH-190),n=new GameObj(JQObject.SLOPE,m.pos.x+m.w-Graphics.projectX,m.pos.y,900,FULLH-190,null,Dir.DOWN_RIGHT);var b=new GameObj(JQObject.PLATFORM,n.pos.x+n.w-Graphics.projectX-1,FULLH-game.padFloor,1e3,game.padFloor);u=Graphics.getScale(b.pos.x+250,FULLH-game.padFloor-137),level.objs.push(u.hBar,u.vBar,u[Dir.LEFT],u[Dir.RIGHT]),o=new GameObj(JQObject.LADDER,b.pos.x+b.w-Graphics.projectX-30,140,30,FULLH-140-game.padFloor),o.visible=!1,o.collidable=!1;var c=new GameObj(JQObject.PLATFORM,o.pos.x+o.w,140,350,game.padFloor);p=new GameObj(JQObject.DOOR,c.pos.x+c.w-90,c.pos.y-100,40,100),level.objs.push(b,n,m,c,p,o)}function c(){var a=new GameItem(new GameObj(JQObject.CRATE,l.pos.x+l.w/2-80,l.pos.y-37,34,37,"crate.png"),!0),b=new GameItem(new GameObj(JQObject.CRATE,l.pos.x+l.w/2+80,l.pos.y-37,34,37,"crate.png"),!0),c=new GameItem(new GameObj(JQObject.SACK,j.pos.x+300,302,30,36,"sack.png"),!0,5);level.items.push(c,a,b)}function d(){var a=new Enemy(new GameObj(JQObject.ENEMY,j.pos.x+j.w,404,40,55,"cyborgBnW.png"),JQEnemy.PATROL,1,j.pos.x+j.w,k.pos.x-27.5,!0);a.collidable=!0,level.enemies.push(a),r=e(),q=new GameObj(JQObject.EMPTY,r.pos.x,r.pos.y,r.w,r.h),q.collidable=!1,q.visible=!1,level.objs.push(q),level.enemies.push(r)}function e(){return en=new Enemy(new GameObj(JQObject.ENEMY,m.pos.x+35,m.pos.y-55,40,55,"cyborgBnW.png"),JQEnemy.STILL,5),en.collidable=!0,en}function f(){if(q.pos.x+q.w>=0&&q.pos.x+q.w<=FULLW){if(v&&(v=!1,r.revive()),r.alive&&null===t){var a;a=hero.pos.x<r.pos.x?Dir.LEFT:Dir.RIGHT,t=new GameObj(JQObject.FIREBALL,r.pos.x,r.pos.y,20,20,null,a),t.tag=level.objs.length,t.collidable=!1,level.objs.push(t)}}else r.alive||(v=!0);null!==t&&(t.dir===Dir.LEFT?--t.pos.x:++t.pos.x,(t.pos.x<=0||t.pos.x>=FULLW)&&(level.objs.splice(t.tag,1),t=null)),!hero.invincible&&null!==t&&SAT.testPolygonPolygon(hero,t)&&(level.objs.splice(t.tag,1),t=null,audio.play(audio.heartbeat,!0),hero.invincible=!0,--hero.health)}var g,h,i,j,k,l,m,n,o,p,q,r,s=[],t=null,u={},v=!1,w=!1;return{width:5030,init:function(){level.hiddenItems=0,b(),c(),d(),a()},deinit:function(){w=!1},update:function(){for(var a=0;a<s.length;++a)s[a].dir===Dir.UP&&s[a].pos.y<100?s[a].dir=Dir.DOWN:s[a].dir===Dir.DOWN&&s[a].pos.y>400&&(s[a].dir=Dir.UP),s[a].vY=s[a].dir===Dir.DOWN?1:-1,s[a].pos.y+=s[a].vY;f(),w?hero.onLadder=SAT.testPolygonPolygon(hero,o):w=Physics.handleScale(),SAT.testPolygonPolygon(hero,p)&&level.complete()},render:function(){Graphics.drawScaleBg(u)}}}();Level3.prototype=function(){function a(){level.bgColor.gradX=1400,level.bgColor.gradY=180,level.bgColor.c0="#222",level.bgColor.c1="#333";var a=ctx.createRadialGradient(level.bgColor.gradX,level.bgColor.gradY,14,level.bgColor.gradX,level.bgColor.gradY,440);a.addColorStop(0,level.bgColor.c0),a.addColorStop(1,level.bgColor.c1),level.bgColor.fillStyle=a,Graphics.setClouds(Level3.prototype.width)}function b(){var a=new GameObj(JQObject.PLATFORM,-Graphics.projectX,FULLH-game.padFloor,1050,game.padFloor);level.objs.push(a)}function c(){d=new Enemy(new GameObj(JQObject.ENEMY,400,FULLH-game.padFloor-160,120,165,"cyborgBnW_boss.png"),JQEnemy.PATROL,1,200,500,!0),d.collidable=!0,level.enemies.push(d)}var d;return{width:1008,init:function(){level.hiddenItems=0,b(),c(),a()},deinit:function(){},update:function(){},render:function(){ctx.fillStyle="#fff",ctx.font="22px 'Press Start 2P'",ctx.fillText("LEVEL 3 -- BOSS BATTLE COMING SOON!!",150,280);
}}}();var game=function(){function a(){level.isCutscene||level.isTransitioning||game.over||hero.update(),level.update()}function b(a){a-g>0&&(h=a-g),g=a,d=requestAnimationFrame(b),level.render(),level.isCutscene||(game.over||hero.render(),HUD.draw(),c())}function c(a){if(i.push(1e3/h),game.totalTicks%120===0){for(var b=0,c=i.length;--c;)b+=i[c];for(f=i.length>0?Math.floor(b/i.length):0;i.length>0;)i.pop()}ctx.fillStyle="#ddd",ctx.font='11px "Press Start 2P"',ctx.fillText(f+" FPS",FULLW-77,FULLH+50)}var d,e,f=0,g=0,h=16,i=[60];return{over:!1,gravity:.13,padHUD:58,padFloor:16,lvl:0,totalTicks:0,actualTime:0,start:function(){e=setInterval(function(){++game.totalTicks,Graphics.ticker+=Graphics.fadeOut?-Graphics.tickerStep:Graphics.tickerStep,a()},8.3333),b()},stop:function(){window.cancelAnimationFrame(d),clearInterval(e)}}}(),Shuriken={w:31,h:31,speed:4.4},hero=function(){function a(){hero.invincible&&--k,k<=0&&(hero.invincible=!1,k=l),hero.health<=0&&!game.over&&utils.deathSequence()}function b(){var a={x:0,y:0};if(hero.isHolding&&0===hero.vX)a=j.playerDown;else if(hero.onLadder)a=j.playerUp;else if(hero.dir===Dir.RIGHT||hero.dir===Dir.LEFT){var b=hero.dir===Dir.RIGHT,c="player"+(b?"Right":"Left");if(b&&hero.vX>0||!b&&hero.vX<0){var d=game.totalTicks%96;hero.isOnObj?Math.abs(hero.vX)<=10*hero.aX?a=j[c+"_Step"]:d>=0&&d<24?(a=j[c+"_Run1"],hero.isJumping||audio.step.play()):d>=24&&d<48?a=j[c+"_Run2"]:d>=48&&d<72?(a=j[c+"_Run3"],hero.isJumping||audio.step.play()):a=j[c+"_Run2"]:a=j[c+"_Run1"]}else a=j[c]}if(hero.onLadder||0!==hero.vX||0!==hero.vY?(hero.idleTime=0,hero.isHolding&&(hero.curItem.pos.y=hero.pos.y+20)):++hero.idleTime,hero.idleTime>210){var e=hero.idleTime%200;e>=0&&e<=50||e>100&&e<=150?a=j.playerDown:e>50&&e<=100?(a=j.playerDown_breatheIn,hero.isHolding&&(hero.curItem.pos.y=hero.pos.y+18)):e>150&&e<=200&&(a=j.playerDown_breatheOut,hero.isHolding&&(hero.curItem.pos.y=hero.pos.y+22))}var f=k%40;hero.invincible&&f>=0&&f<=16&&(a={x:-1,y:-1}),hero.sx=a.x,hero.sy=a.y}function c(){h&&hero.sx>=0&&hero.sy>=0&&ctx.drawImage(i,hero.sx,hero.sy,hero.w,hero.h,Math.round(hero.pos.x),Math.round(hero.pos.y),hero.w,hero.h)}function d(){hero.isHolding&&hero.curItem.draw()}var e=null,f=null,g=null,h=!1,i=null,j=[],k=170,l=170;return{sx:0,sy:0,lvlX:0,w:48,h:65,vX:0,vY:0,aX:.17,aY:.82,jumpMod:4,jumpMod0:4,idleTime:0,dir:Dir.RIGHT,onLadder:!1,invincible:!1,isJumping:!1,isHolding:!1,isOnObj:!0,curItem:null,lives:3,health:3,maxHealth:3,medKits:1,healthLvl:1,mana:0,maxMana:4,manaKits:1,manaLvl:1,ammo:20,cash:0,lvl:1,xp:0,xpNeeded:50,bulletArr:[],init:function(){i=new Image,i.onload=function(){h=!0},i.src="img/sprites/player/player.png",$.get("img/sprites/player/player.xml",function(a){var b=$(a).find("sprite");$(b).each(function(){var a=$(this).attr("n"),b=$(this).attr("x"),c=$(this).attr("y");a=a.substring(0,a.length-4),j[a]={x:b,y:c}})}),e=HeroInputComponent(),g=HeroPhysicsComponent(),f=new HeroGraphicsComponent,$.extend(hero,new SAT.Box(new SAT.Vector(0,0),hero.w,hero.h).toPolygon())},update:function(){e.check(),g.updatePosition(),g.checkCollision(),a(),b()},render:function(){c(),f.drawBullets(),d()},landed:function(a){hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0,hero.pos.y-=a}}}(),HeroGraphicsComponent=function(){function a(){var b=this;_classCallCheck(this,a),this.shurikenReady=!1,this.shuriken=new Image,this.shuriken.src="img/shuriken.png",this.shuriken.onload=function(){b.shurikenReady=!0}}return _createClass(a,[{key:"drawBullets",value:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=hero.bulletArr[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value,g=f.dirR?hero.w:0;f.deg+=5,this.shurikenReady&&Graphics.drawRotate(this.shuriken,f.pos.x+g,f.pos.y+20,f.deg)}}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}}}]),a}(),HeroPhysicsComponent=function(){function a(){for(var a=0;a<hero.bulletArr.length;++a)hero.bulletArr[a].pos.x+=hero.bulletArr[a].dirR?Shuriken.speed:-Shuriken.speed,hero.bulletArr[a].pos.x>FULLW||hero.bulletArr[a].pos.x<0?hero.bulletArr.splice(a,1):Physics.testObjObjs(hero.bulletArr[a],function(){hero.bulletArr.splice(a,1)})}function b(){hero.pos.y<2*-hero.h?(hero.pos.y=2*-hero.h,hero.vY=0):hero.pos.y>=FULLH+2*hero.h&&(game.over||utils.deathSequence()),hero.pos.x<0?(hero.pos.x=0,hero.vX=0):hero.pos.x>FULLW-hero.w&&(hero.pos.x=FULLW-hero.w,hero.vX=0)}function c(){hero.isOnObj=!1,Physics.testObjObjs(hero,function(a){var b={x:Dir.NONE,y:Dir.NONE};1===a.overlapN.y?b.y=Dir.TOP:a.overlapN.y===-1&&(b.y=Dir.BOT),1===a.overlapN.x?b.x=Dir.LEFT:a.overlapN.y===-1&&(b.x=Dir.RIGHT),a.b.type===JQObject.SLOPE||a.b.type===JQObject.POLY||a.b.type===JQObject.HILL?hero.vY>=0&&hero.landed(a.overlapV.y):a.b.type===JQObject.ELEVATOR?b.y===Dir.TOP&&hero.vY>=0&&(hero.isOnObj=!0,hero.isJumping=!1,hero.vY=a.b.vY>0?a.b.vY:0,a.a.pos.y-=a.overlapV.y):(a.a.pos.x-=a.overlapV.x,b.y===Dir.TOP&&hero.vY>=0?hero.landed(a.overlapV.y):b.y===Dir.BOT&&hero.vY<=0&&(hero.vY=0,a.a.pos.y-=a.overlapV.y))}),hero.isHolding&&(0===hero.vX?(hero.curItem.pos.x=hero.pos.x+7,hero.curItem.pos.y=hero.pos.y+20):(hero.curItem.pos.x=hero.pos.x+(hero.dir===Dir.RIGHT?45:-32),hero.curItem.pos.y=hero.pos.y+16)),Physics.testHeroItems(function(a,b){a.b.type===JQObject.CRATE?1===a.overlapN.y?(hero.pos.y-=a.overlapV.y,hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0,"undefined"!=typeof a.b.onObj&&null!==a.b.onObj&&a.b.onObj.type===JQObject.ELEVATOR&&(hero.vY=a.b.vY)):hero.isHolding||!a.b.grabbable||a.b.recentlyHeld||(a.b.isOnObj===!0&&(a.b.isOnObj=!1,null!==a.b.onObj&&(a.b.onObj.grabbable=!0,a.b.onObj=null)),a.b.isBeingHeld=!0,hero.curItem=a.b,hero.isHolding=!0,level.items.splice(b,1)):(audio.itemPickedUp.play(),a.b.type===JQObject.SACK?hero.ammo+=a.b.val:a.b.type===JQObject.CASH&&(hero.cash+=a.b.val),level.items.splice(b,1))})}return{updatePosition:function(){if((hero.dir===Dir.RIGHT&&hero.pos.x>=HALFW+35||hero.dir===Dir.LEFT&&hero.pos.x<=HALFW-45)&&hero.lvlX+hero.vX>=0&&hero.lvlX+hero.vX<=level.curLvl.width-FULLW){hero.lvlX+=hero.vX;for(var a=0;a<hero.bulletArr.length;++a)hero.bulletArr[a].pos.x-=hero.vX;level.updateView()}else hero.pos.x+=hero.vX;hero.onLadder||(hero.pos.y+=hero.vY)},checkCollision:function(){a(),b(),c()}}},KeyCode=Object.freeze({ENTER:13,CTRL:17,A:65,D:68,F:70,H:72,J:74,K:75,M:77,O:79,R:82,S:83,W:87,EMPTY:-1,SPACEBAR:32}),HeroInputComponent=function(){var a=3,b=10;return keysDown={},lastKeyDown=-1,$(document).on("click",".resize",function(){$(this).hasClass("off")?($(this).removeClass("off").addClass("on"),$(this).children("iron-icon").prop("icon","icons:fullscreen-exit")):$(this).hasClass("on")&&($(this).removeClass("on").addClass("off"),$(this).children("iron-icon").prop("icon","icons:fullscreen")),utils.toggleFullScreen()}),addEventListener("keydown",function(a){if(a.keyCode===KeyCode.SPACEBAR)a.preventDefault();else if(a.keyCode===KeyCode.M)audio.handleMuteButton();else if(a.keyCode===KeyCode.F)$(".resize").trigger("click");else if(a.keyCode!==KeyCode.K||hero.isJumping||lastKeyDown===KeyCode.K&&keysDown[KeyCode.K]||!hero.isOnObj){if(a.keyCode!==KeyCode.J||lastKeyDown==KeyCode.J&&keysDown[KeyCode.J])a.keyCode==KeyCode.O&&utils.toggleMenu();else if(hero.ammo>0&&!hero.isHolding){audio.play(audio.effort);var b=new GameObj(JQObject.SHURIKEN,hero.pos.x,hero.pos.y+Shuriken.h/2,Shuriken.w,Shuriken.h);b.dirR=hero.dir===Dir.RIGHT,b.deg=0,hero.bulletArr.push(b),--hero.ammo,hero.idleTime=0}}else audio.jump.play(),hero.vY=0,hero.isJumping=!0,hero.isOnObj=!1;lastKeyDown=a.keyCode,keysDown[a.keyCode]=!0},!1),addEventListener("keyup",function(a){delete keysDown[a.keyCode]},!1),{check:function(){var c=!1;if(hero.isJumping?hero.jumpMod>0?hero.vY-=hero.aY*hero.jumpMod--:c=!0:(hero.jumpMod=hero.jumpMod0,c=!0),c&&!hero.onLadder){var d=hero.vY+2*game.gravity;d>b?hero.vY=b:hero.vY=d}var e=!1;keysDown[KeyCode.A]&&(hero.vX=Math.abs(hero.vX-hero.aX)>a?-a:hero.vX-hero.aX,hero.dir=Dir.LEFT,e=!0),keysDown[KeyCode.D]&&(hero.vX=Math.abs(hero.vX+hero.aX)>a?a:hero.vX+hero.aX,hero.dir=Dir.RIGHT,e=!0),Math.abs(hero.vX)<hero.aX?hero.vX=0:e||(hero.vX/=1.26),keysDown[KeyCode.W]&&hero.onLadder&&--hero.pos.y,keysDown[KeyCode.S]&&hero.onLadder&&++hero.pos.y,keysDown[KeyCode.SPACEBAR]&&hero.isHolding&&(hero.isHolding=!1,hero.curItem.isBeingHeld=!1,hero.curItem.recentlyHeld=!0,level.items.push(hero.curItem),hero.curItem=null),keysDown[KeyCode.H]&&hero.medKits>0&&hero.health<hero.maxHealth&&(++hero.health,--hero.medKits,audio.play(audio.enchant,!0)),keysDown[KeyCode.R]&&!keysDown[KeyCode.CTRL]&&hero.manaKits>0&&hero.mana<hero.maxMana&&(++hero.mana,--hero.manaKits,audio.play(audio.enchant,!0))}}},Main=function(){function a(){_classCallCheck(this,a),this.setCanvasGlobals(),this.loadingScreen(),hero.init(),window.audio=new GameAudio,level.init(),window.HUD=new Hud}return _createClass(a,[{key:"onFontLoaded",value:function(){setInterval(function(){++game.actualTime},1e3),game.start()}},{key:"setCanvasGlobals",value:function(){window.canvas=document.querySelector("canvas"),window.ctx=canvas.getContext("2d"),window.FULLW=canvas.width,window.FULLH=canvas.height-game.padHUD,window.HALFW=FULLW/2,window.HALFH=FULLH/2}},{key:"loadingScreen",value:function(){ctx.fillStyle="#e1e1e1",ctx.font='25px "Press Start 2P"',ctx.fillText("LOADING...",HALFW-80,HALFH+20)}},{key:"debug",value:function(){"jons-quest-jonmann20.c9users.io"===location.hostname&&(window.DEBUG=!0,window.DEBUG_OPT={lvl:3},canvas.style.transition="opacity 0.01s",lastKeyDown=KeyCode.ENTER)}}]),a}();$(function(){var a=new Main;window.WebFontConfig={google:{families:["Press Start 2P"]},active:function(){a.onFontLoaded()},inactive:function(){alert("There was a problem loading a font from google, some text may not render correctly (refreshing the page may fix the issue)."),a.onFontLoaded()}},function(){var a=document.createElement("script");a.src="https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",a.type="text/javascript",a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}()});
//# sourceMappingURL=jons-quest.js.map