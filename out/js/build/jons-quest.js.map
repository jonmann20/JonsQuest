{
  "version": 3,
  "file": "jons-quest.js",
  "sources": [
    "node_modules/sat/SAT.min.js",
    "js/build/jons-quest.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0X;ACdA,miuC",
  "sourcesContent": [
    "/*\n SAT.js - Version 0.7.0 - Copyright 2012 - 2018 - Jim Riecken <jimr@jimr.ca> - released under the MIT License. https://github.com/jriecken/sat-js */\n function x(){function c(a,d){this.x=a||0;this.y=d||0}function B(a,d){this.pos=a||new c;this.r=d||0}function m(a,d){this.pos=a||new c;this.angle=0;this.offset=new c;this.u(d||[])}function p(a,d,b){this.pos=a||new c;this.w=d||0;this.h=b||0}function w(){this.b=this.a=null;this.overlapN=new c;this.overlapV=new c;this.clear()}function C(a,d,b){for(var g=Number.MAX_VALUE,c=-Number.MAX_VALUE,l=a.length,v=0;v<l;v++){var e=a[v].f(d);e<g&&(g=e);e>c&&(c=e)}b[0]=g;b[1]=c}function y(a,d,b,g,c,l){var k=q.pop(),\ne=q.pop();a=h.pop().c(d).sub(a);d=a.f(c);C(b,c,k);C(g,c,e);e[0]+=d;e[1]+=d;if(k[0]>e[1]||e[0]>k[1])return h.push(a),q.push(k),q.push(e),!0;l&&(k[0]<e[0]?(l.aInB=!1,k[1]<e[1]?(b=k[1]-e[0],l.bInA=!1):(b=k[1]-e[0],g=e[1]-k[0],b=b<g?b:-g)):(l.bInA=!1,k[1]>e[1]?(b=k[0]-e[1],l.aInB=!1):(b=k[1]-e[0],g=e[1]-k[0],b=b<g?b:-g)),g=Math.abs(b),g<l.overlap&&(l.overlap=g,l.overlapN.c(c),0>b&&l.overlapN.reverse()));h.push(a);q.push(k);q.push(e);return!1}function z(a,d){var b=a.g(),g=d.f(a);return 0>g?-1:g>b?1:0}\nfunction D(a,d,b){for(var g=h.pop().c(d.pos).sub(a.pos),c=d.r,l=c*c,v=a.calcPoints,e=v.length,t=h.pop(),f=h.pop(),m=0;m<e;m++){var u=m===e-1?0:m+1,q=0===m?e-1:m-1,p=0,r=null;t.c(a.edges[m]);f.c(g).sub(v[m]);b&&f.g()>l&&(b.aInB=!1);var n=z(t,f);if(-1===n){t.c(a.edges[q]);u=h.pop().c(g).sub(v[q]);n=z(t,u);if(1===n){n=f.j();if(n>c)return h.push(g),h.push(t),h.push(f),h.push(u),!1;b&&(b.bInA=!1,r=f.normalize(),p=c-n)}h.push(u)}else if(1===n){if(t.c(a.edges[u]),f.c(g).sub(v[u]),n=z(t,f),-1===n){n=f.j();\nif(n>c)return h.push(g),h.push(t),h.push(f),!1;b&&(b.bInA=!1,r=f.normalize(),p=c-n)}}else{u=t.m().normalize();n=f.f(u);q=Math.abs(n);if(0<n&&q>c)return h.push(g),h.push(u),h.push(f),!1;b&&(r=u,p=c-n,0<=n||p<2*c)&&(b.bInA=!1)}r&&b&&Math.abs(p)<Math.abs(b.overlap)&&(b.overlap=p,b.overlapN.c(r))}b&&(b.a=a,b.b=d,b.overlapV.c(b.overlapN).scale(b.overlap));h.push(g);h.push(t);h.push(f);return!0}function E(a,d,b){for(var c=a.calcPoints,k=c.length,l=d.calcPoints,f=l.length,e=0;e<k;e++)if(y(a.pos,d.pos,c,\nl,a.normals[e],b))return!1;for(e=0;e<f;e++)if(y(a.pos,d.pos,c,l,d.normals[e],b))return!1;b&&(b.a=a,b.b=d,b.overlapV.c(b.overlapN).scale(b.overlap));return!0}var f={};f.Vector=c;f.V=c;c.prototype.copy=c.prototype.c=function(a){this.x=a.x;this.y=a.y;return this};c.prototype.clone=c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.perp=c.prototype.m=function(){var a=this.x;this.x=this.y;this.y=-a;return this};c.prototype.rotate=c.prototype.rotate=function(a){var d=this.x,b=this.y;\nthis.x=d*Math.cos(a)-b*Math.sin(a);this.y=d*Math.sin(a)+b*Math.cos(a);return this};c.prototype.reverse=c.prototype.reverse=function(){this.x=-this.x;this.y=-this.y;return this};c.prototype.normalize=c.prototype.normalize=function(){var a=this.j();0<a&&(this.x/=a,this.y/=a);return this};c.prototype.add=c.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};c.prototype.sub=c.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};c.prototype.scale=c.prototype.scale=function(a,d){this.x*=\na;this.y*=d||a;return this};c.prototype.project=c.prototype.o=function(a){var d=this.f(a)/a.g();this.x=d*a.x;this.y=d*a.y;return this};c.prototype.projectN=c.prototype.s=function(a){var d=this.f(a);this.x=d*a.x;this.y=d*a.y;return this};c.prototype.reflect=function(a){var d=this.x,b=this.y;this.o(a).scale(2);this.x-=d;this.y-=b;return this};c.prototype.reflectN=function(a){var d=this.x,b=this.y;this.s(a).scale(2);this.x-=d;this.y-=b;return this};c.prototype.dot=c.prototype.f=function(a){return this.x*\na.x+this.y*a.y};c.prototype.len2=c.prototype.g=function(){return this.f(this)};c.prototype.len=c.prototype.j=function(){return Math.sqrt(this.g())};f.Circle=B;B.prototype.getAABB=function(){var a=this.r,d=this.pos.clone().sub(new c(a,a));return(new p(d,2*a,2*a)).l()};f.Polygon=m;m.prototype.setPoints=m.prototype.u=function(a){if(!this.points||this.points.length!==a.length){var d,b=this.calcPoints=[],g=this.edges=[],k=this.normals=[];for(d=0;d<a.length;d++)b.push(new c),g.push(new c),k.push(new c)}this.points=\na;this.i()};m.prototype.setAngle=function(a){this.angle=a;this.i();return this};m.prototype.setOffset=function(a){this.offset=a;this.i();return this};m.prototype.rotate=m.prototype.rotate=function(a){for(var d=this.points,b=d.length,c=0;c<b;c++)d[c].rotate(a);this.i();return this};m.prototype.translate=m.prototype.translate=function(a,d){for(var b=this.points,c=b.length,k=0;k<c;k++)b[k].x+=a,b[k].y+=d;this.i();return this};m.prototype.i=function(){var a=this.calcPoints,c=this.edges,b=this.normals,\ng=this.points,k=this.offset,l=this.angle,f=g.length,e;for(e=0;e<f;e++){var h=a[e].c(g[e]);h.x+=k.x;h.y+=k.y;0!==l&&h.rotate(l)}for(e=0;e<f;e++)g=a[e],g=c[e].c(e<f-1?a[e+1]:a[0]).sub(g),b[e].c(g).m().normalize()};m.prototype.getAABB=function(){for(var a=this.calcPoints,d=a.length,b=a[0].x,g=a[0].y,k=a[0].x,l=a[0].y,f=1;f<d;f++){var e=a[f];e.x<b?b=e.x:e.x>k&&(k=e.x);e.y<g?g=e.y:e.y>l&&(l=e.y)}return(new p(this.pos.clone().add(new c(b,g)),k-b,l-g)).l()};m.prototype.getCentroid=function(){for(var a=this.calcPoints,\nd=a.length,b=0,g=0,k=0,f=0;f<d;f++){var h=a[f],e=f===d-1?a[0]:a[f+1],m=h.x*e.y-e.x*h.y;b+=(h.x+e.x)*m;g+=(h.y+e.y)*m;k+=m}k*=3;return new c(b/k,g/k)};f.Box=p;p.prototype.toPolygon=p.prototype.l=function(){var a=this.pos,d=this.w,b=this.h;return new m(new c(a.x,a.y),[new c,new c(d,0),new c(d,b),new c(0,b)])};f.Response=w;w.prototype.clear=w.prototype.clear=function(){this.bInA=this.aInB=!0;this.overlap=Number.MAX_VALUE;return this};for(var h=[],r=0;10>r;r++)h.push(new c);var q=[];for(r=0;5>r;r++)q.push([]);\nvar A=new w,F=(new p(new c,1E-6,1E-6)).l();f.isSeparatingAxis=y;f.pointInCircle=function(a,c){var b=h.pop().c(a).sub(c.pos),d=c.r*c.r,f=b.g();h.push(b);return f<=d};f.pointInPolygon=function(a,c){F.pos.c(a);A.clear();var b=E(F,c,A);b&&(b=A.aInB);return b};f.testCircleCircle=function(a,c,b){var d=h.pop().c(c.pos).sub(a.pos),f=a.r+c.r,l=d.g();if(l>f*f)return h.push(d),!1;b&&(l=Math.sqrt(l),b.a=a,b.b=c,b.overlap=f-l,b.overlapN.c(d.normalize()),b.overlapV.c(d).scale(b.overlap),b.aInB=a.r<=c.r&&l<=c.r-\na.r,b.bInA=c.r<=a.r&&l<=a.r-c.r);h.push(d);return!0};f.testPolygonCircle=D;f.testCirclePolygon=function(a,c,b){if((a=D(c,a,b))&&b){c=b.a;var d=b.aInB;b.overlapN.reverse();b.overlapV.reverse();b.a=b.b;b.b=c;b.aInB=b.bInA;b.bInA=d}return a};f.testPolygonPolygon=E;return f}\"function\"===typeof define&&define.amd?define(x):\"object\"===typeof exports?module.exports=x():this.SAT=x();",
    "let utils=(()=>{var e;return{extend:function(e,t){$.extend(e,t);Object.defineProperty(e,\"imgReady\",{get:function(){return t.imgReady}})},speed2scale:function(e){return-.5*e+2},randF:function(e,t,o){return void 0===o&&(o=2),parseFloat(Math.min(e+Math.random()*(t-e),t).toFixed(o))},repeatAction:function(e,t,o){var l=0,i=setInterval(function(){l++>t?clearInterval(i):o()},e)},deathSequence:function(){game.over||(game.over=!0,audio.heroDeath.play(),audio.bgMusic.muted=!0,setTimeout(function(){Graphics.fadeCanvas(function(){hero.lives-1<0?(alert(\"You Lose\"),location.reload()):--hero.lives,level.reset(),level.curLvl.deinit(),level.curLvl.init(),audio.isOn&&(audio.bgMusic.muted=!1)})},2600))},degToRad:function(e){return.017453292519943295*e},revFactorial:function(e){for(var t=2,o=e;1!==o;){if(0===(o/=t))return-1;if(1===o)return t;++t}},getTimeObj:function(e){if(0===e)return{min:\"00\",sec:\"00\"};let t=Math.floor(e/60),o=e%60;return o<10&&(o=\"0\"+o),t<10&&(t=\"0\"+t),{min:t,sec:o}},browser:function(){let e,t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*([\\d\\.]+)/i)||[];return/trident/i.test(o[1])?\"IE \"+((e=/\\brv[ :]+(\\d+(\\.\\d+)?)/g.exec(t)||[])[1]||\"\"):(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,\"-?\"],null!=(e=t.match(/version\\/([\\.\\d]+)/i))&&(o[2]=e[1]),o.join(\" \"))},printSlow:function(e){game.actualTime},printMouse:function(){$(\"canvas\").on(\"mousemove\",function(e){})},printDir:function(e){e},toggleMenu:function(){\"block\"===$(\"#colorbox\").css(\"display\")?e.colorbox.close():e=$.colorbox({html:document.querySelector(\".gameInstructions\").innerHTML,width:320,height:530})},toggleFullScreen:function(){if(document.body.classList.contains(\"fullscreen\"))$(\".canvasWrap\").css({width:\"\",marginLeft:\"\"}),document.body.classList.remove(\"fullscreen\");else{document.body.classList.add(\"fullscreen\");var e=1.777778*$(window).height();$(\".canvasWrap\").css({width:e,marginLeft:-e/2})}}}})();const Dir=Object.freeze({NONE:0,TOP:1,BOT:2,LEFT:3,RIGHT:4,IN:5,UP:6,DOWN:7,UP_RIGHT:8,DOWN_RIGHT:9}),Color=Object.freeze({LIGHT_BROWN:\"#c44525\",DARK_BROWN:\"#672819\",LIGHT_GREEN:\"#166a38\",SILVER:\"#c0c0c0\",BLACK:\"#000\",GOLD:\"#ddaa13\",ORANGE:\"#ff6a00\"});class GameAudio{constructor(){this.bgMusic=new Audio(\"audio/firstChiptune/firstChiptune.mp3\"),this.bgMusic.loop=!0,this.bgMusic.volume=.7,this.bgMusic.pause(),this.enemyDeath=new Audio(\"audio/death.mp3\"),this.enemyDeath.volume=.6,this.jump=new Audio(\"audio/jump.mp3\"),this.jump.volume=.4,this.thud=new Audio(\"audio/thud.mp3\"),this.thud.volume=.78,this.discovery=new Audio(\"audio/spell3.mp3\"),this.discovery.volume=.7,this.enterSound=new Audio(\"audio/synthetic_explosion_1.mp3\"),this.exitSound=new Audio(\"audio/annulet.mp3\"),this.itemPickedUp=new Audio(\"audio/life_pickup.mp3\"),this.heartbeat=new Audio(\"audio/heartbeat.mp3\"),this.step=new Audio(\"audio/step.mp3\"),this.effort=new Audio(\"audio/woosh.mp3\"),this.heroDeath=new Audio(\"audio/DiscsOfTron_Cascade.mp3\"),this.enchant=new Audio(\"audio/enchant.mp3\"),this.isOn=!1,this.mute(!0),$(document).on(\"click\",\".audioState\",()=>{this.handleMuteButton()}),document.querySelector(\".menu\").addEventListener(\"click\",e=>{e.preventDefault(),utils.toggleMenu()})}lvlComplete(){let e;switch(this.bgMusic.pause(),game.lvl){case 0:return void this.enterSound.play();default:this.exitSound.play(),e=\"sweetAcoustic.mp3\"}setTimeout(()=>{this.bgMusic=new Audio(`audio/${e}`),this.bgMusic.loop=!0,this.bgMusic.volume=.45,this.isOn?this.bgMusic.play():this.bgMusic.pause()},1e3)}updateBgMusic(){let e;switch(this.bgMusic.pause(),game.lvl){case 1:case 2:e=\"inspiredBySparkMan/sparkBoy.mp3\";break;case 3:e=\"bossBeat/bossBeat.mp3\";break;default:e=\"sweetAcoustic.mp3\"}setTimeout(()=>{this.bgMusic=new Audio(`audio/${e}`),this.bgMusic.loop=!0,this.bgMusic.volume=.45,this.isOn?this.bgMusic.play():this.bgMusic.pause()},1e3)}play(e,t){t=void 0===t||t,e.ended?e.play():(t||0===e.currentTime)&&(e.pause(),e.currentTime=0,e.play())}handleMuteButton(){Array.from(document.querySelectorAll(\".audioState\")).forEach(e=>{e.classList.contains(\"off\")?($(\".audioState iron-icon\").attr(\"icon\",\"i:volume-up\"),e.classList.remove(\"off\"),e.classList.add(\"on\"),this.mute(!1)):($(\".audioState iron-icon\").attr(\"icon\",\"i:volume-off\"),e.classList.remove(\"on\"),e.classList.add(\"off\"),this.mute(!0))})}mute(e){this.discovery.muted=this.enterSound.muted=this.bgMusic.muted=this.itemPickedUp.muted=this.heartbeat.muted=this.effort.muted=this.thud.muted=this.jump.muted=this.step.muted=this.enemyDeath.muted=this.heroDeath.muted=this.enchant.muted=this.exitSound.muted=e,e?this.bgMusic.pause():this.bgMusic.play(),this.isOn=!e}}var Graphics=(()=>{var e=1,t=null,o=250,l=250;return{ticker:1,tickerStep:.01,fadeOut:!1,projectX:8,projectY:11,fadeCanvas:function(e){\"MSIE 9.0\"===utils.browser()?e():($(canvas).removeClass(\"preTransition\"),$(canvas).addClass(\"duringTransition\"),t=$(canvas).on(\"transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd\",function(){t.off(),$(this).removeClass(\"duringTransition\"),$(this).addClass(\"preTransition\"),e()}))},blinkText:function(t,o,l,i){i=void 0!==i?i:\"PRESS ENTER\",(Graphics.ticker>=1.35||Graphics.ticker<=Graphics.tickerStep)&&(Graphics.fadeOut=!Graphics.fadeOut),e=Graphics.ticker>=1?1:Graphics.ticker<=Graphics.tickerStep?0:Graphics.ticker,ctx.font=`${t}px \"Press Start 2P\"`;const r=ctx.measureText(i).width;ctx.fillStyle=`rgba(233, 233, 233, ${e})`,ctx.fillText(i,o-r/2,l)},getSkewedRect:function(e,t,o,l){return t+=Graphics.projectY/2,new SAT.Polygon(new SAT.Vector(e,t),[new SAT.Vector,new SAT.Vector(o-Graphics.projectX,0),new SAT.Vector(o,Graphics.projectY),new SAT.Vector(o,l),new SAT.Vector(Graphics.projectX,l),new SAT.Vector(0,l-Graphics.projectY)])},getStairPoly:function(e,t,o,l,i){return i===Dir.UP_RIGHT?new SAT.Polygon(new SAT.Vector(e,t),[new SAT.Vector,new SAT.Vector(o-Graphics.projectX,-l),new SAT.Vector(o,-l+Graphics.projectY),new SAT.Vector(o,0),new SAT.Vector(Graphics.projectX,l),new SAT.Vector(0,l-Graphics.projectY)]):new SAT.Polygon(new SAT.Vector(e,t),[new SAT.Vector,new SAT.Vector(o-Graphics.projectX,l-Graphics.projectY-5),new SAT.Vector(o,l-4),new SAT.Vector(0,l),new SAT.Vector(Graphics.projectX,l),new SAT.Vector(0,l-Graphics.projectY)])},setClouds:e=>{let t=0;for(;t<e;)t=Graphics.spawnCloud(t)},spawnCloud:function(e){var t=Math.floor(170*Math.random()),o=utils.randF(2,3.3,1),l=120*utils.speed2scale(o);e+=l+Math.floor(20*Math.random()+8);var i=new GameObj(JQObject.CLOUD,e,10+t,0,0,\"cloud.png\");return i.speed=o,i.distTraveled=0,i.distToTravel=e+l,level.bg.push(i),e},drawLadder:function(e){var t=e.pos.x,o=e.pos.y,l=e.edges[0].x,i=e.edges[1].y;ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(t,o,5,i),ctx.fillRect(t+l-5,o,5,i);for(var r=13;r<i;r+=20)ctx.fillRect(t,o+r,l,8)},getScale:function(e,t){for(var o={},l=0;l<2;++l){var i=0===l?Dir.LEFT:Dir.RIGHT;o[i]=new GameObj(JQObject.SCALE,e+300*l,t,150,46),o[i].holdingItem=null}return o.vBar=new GameObj(JQObject.SCALEBG,o[Dir.LEFT].pos.x+o[Dir.LEFT].w+70,HALFH-game.padFloor,10,HALFH),o.vBar.collidable=!1,o.hBar=new GameObj(JQObject.SCALEBG,o[Dir.LEFT].pos.x+o[Dir.LEFT].w/2,HALFH,300,10),o.hBar.x2=o.hBar.pos.x+o.hBar.w,o.hBar.y2=o.hBar.pos.y,o.hBar.collidable=!1,o.hBar.visible=!1,o[Dir.LEFT].hBar=o.hBar,o[Dir.LEFT].side=Dir.LEFT,o[Dir.LEFT].otherSide=o[Dir.RIGHT],o[Dir.RIGHT].hBar=o.hBar,o[Dir.RIGHT].side=Dir.RIGHT,o[Dir.RIGHT].otherSide=o[Dir.LEFT],o},drawScale:function(e){var t=e.pos.x,o=e.pos.y,l=e.edges[0].x,i=e.edges[1].y;ctx.fillStyle=Color.BLACK,ctx.fillRect(t,o-1,l,1),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(t,o,l,i)},drawScaleChains:function(e,t,o){ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(o.pos.x,o.pos.y),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(o.pos.x+o.w/2,o.pos.y),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(o.pos.x+o.w,o.pos.y),ctx.stroke(),ctx.closePath()},drawScaleBg:function(e){ctx.strokeStyle=\"#000\",ctx.lineWidth=10,ctx.beginPath(),ctx.moveTo(e.hBar.pos.x,e.hBar.pos.y),ctx.lineTo(e.hBar.x2,e.hBar.y2),ctx.stroke(),ctx.closePath(),Graphics.drawScaleChains(e.hBar.pos.x,e.hBar.pos.y,e[Dir.LEFT]),Graphics.drawScaleChains(e.hBar.x2,e.hBar.y2,e[Dir.RIGHT])},drawPoly:function(e,t,o){let l=e.pos.y-Graphics.projectY,i=e.pos.x;void 0!==o&&(i+=o.x,l+=o.y),ctx.fillStyle=void 0!==t?t:\"orange\",ctx.beginPath(),ctx.moveTo(i,l);for(let t of e.points)ctx.lineTo(i+t.x,l+t.y);ctx.closePath(),ctx.fill()},drawHill:e=>{for(let t=0;t<game.padFloor-15;++t)Graphics.drawPoly(e,Color.LIGHT_BROWN,{x:0,y:t});Graphics.drawPoly(e,Color.DARK_BROWN,{x:Graphics.projectX,y:game.padFloor})},getHill:function(e,t,o,l){var i=[new SAT.V];e+=o/2,t+=Graphics.projectY;for(var r,s,n=o/2,a=l/2,c=180;360!==c;)r=n*Math.cos(utils.degToRad(c)),s=a*Math.sin(utils.degToRad(c++)),i.push(new SAT.V(r,s));return i.push(new SAT.V(o/2)),new SAT.Polygon(new SAT.V(e,t),i)},drawPlatform:function(e){var t=e.pos.y-Graphics.projectY/2;ctx.fillStyle=Color.LIGHT_BROWN,ctx.beginPath(),ctx.moveTo(e.pos.x,t),ctx.lineTo(e.pos.x+e.points[1].x,t+e.points[1].y),ctx.lineTo(e.pos.x+e.points[2].x,t+e.points[2].y),ctx.lineTo(e.pos.x+Graphics.projectX,t+Graphics.projectY),ctx.closePath(),ctx.fill(),ctx.fillStyle=Color.DARK_BROWN,ctx.beginPath(),ctx.moveTo(e.pos.x+e.points[2].x,t+e.points[2].y),ctx.lineTo(e.pos.x+e.points[3].x,t+e.points[3].y),ctx.lineTo(e.pos.x+e.points[4].x,t+e.points[4].y),ctx.lineTo(e.pos.x+e.points[5].x,t+e.points[5].y),ctx.lineTo(e.pos.x+e.points[0].x,t+e.points[0].y),ctx.lineTo(e.pos.x+Graphics.projectX,t+Graphics.projectY),ctx.closePath(),ctx.fill()},drawPlatformStatus:function(e){var t=e.pos.x,o=e.pos.y,l=t+e.w/2-13,i=o+e.h/2-13;ctx.lineWidth=3,null!==e.holdingItem&&e.holdingItem.type===JQObject.CRATE?(ctx.strokeStyle=\"green\",--i,ctx.beginPath(),ctx.moveTo(l,i+13),ctx.lineTo(l+13,i+26),ctx.moveTo(l+13-1,i+26),ctx.lineTo(l+26+2,i+2),ctx.stroke(),ctx.closePath()):(ctx.strokeStyle=\"red\",ctx.beginPath(),ctx.moveTo(l,i),ctx.lineTo(l+26,i+26),ctx.moveTo(l,i+26),ctx.lineTo(l+26,i),ctx.stroke(),ctx.closePath())},drawDoor:function(e){var t=e.pos.x,o=e.pos.y,l=e.w,i=e.h;ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillRect(t+2,o+2,l-2,i-2),ctx.fillStyle=Color.DARK_BROWN,ctx.fillRect(t,o,2,i),ctx.fillRect(t,o,l,2),ctx.fillRect(t+l,o,2,i),ctx.beginPath(),ctx.arc(t+l-l/3.2,o+i-i/3.4,4,0,2*Math.PI,!1),ctx.fill(),ctx.closePath(),ctx.font=\"19px 'Press Start 2P'\",ctx.fillStyle=Color.DARK_BROWN,ctx.fillText(\"EXIT\",t-15,o-3),ctx.fillStyle=Color.LIGHT_BROWN,ctx.fillText(\"EXIT\",t-18,o-5)},getDoorBgGrad:function(){var e=ctx.createRadialGradient(level.bgColor.gradX,level.bgColor.gradY,14,level.bgColor.gradX,level.bgColor.gradY,490-l);return-250==--o?(o=250,l=250):o<0?++l:--l,e.addColorStop(0,level.bgColor.c0),e.addColorStop(1,level.bgColor.c1),e},drawEllipse:(e,t,o,l)=>{const i=o/2*.5522848,r=l/2*.5522848,s=e+o,n=t+l,a=e+o/2,c=t+l/2;ctx.beginPath(),ctx.moveTo(e,c),ctx.bezierCurveTo(e,c-r,a-i,t,a,t),ctx.bezierCurveTo(a+i,t,s,c-r,s,c),ctx.bezierCurveTo(s,c+r,a+i,n,a,n),ctx.bezierCurveTo(a-i,n,e,c+r,e,c),ctx.closePath(),ctx.fill()},drawRotate:(e,t,o,l)=>{ctx.save(),ctx.translate(t,o),ctx.rotate(utils.degToRad(l)),ctx.translate(.5*-e.width,.5*-e.height),ctx.drawImage(e,0,0),ctx.restore()}}})();let Physics={isCollision:function(e,t,o,l){var i=void 0!==l?e.pos.x+e.lvlX:e.pos.x;return i+o<=t.pos.x+t.w&&t.pos.x+o<=i+e.w&&e.pos.y+o<=t.pos.y+t.h&&t.pos.y+o<=e.pos.y+e.h},isSATcollision:function(e,t,o){var l=new SAT.Response;SAT.testPolygonPolygon(e,t,l)&&o(l)},testObjObjs:function(e,t){for(var o=new SAT.Response,l=0;l<level.objs.length;++l){var i=level.objs[l];void 0===i.collidable&&(SAT.testPolygonPolygon(e,i,o)&&t(o),o.clear())}},testItemItems:function(e,t){for(var o=new SAT.Response,l=0;l<level.items.length;++l)if(!level.items[l].isBeingHeld){if(level.items[l].type!==JQObject.CRATE)continue;if(SAT.testPolygonPolygon(e,level.items[l],o)&&1===o.overlapN.y){o.a.pos.x-=o.overlapV.x,o.a.pos.y-=o.overlapV.y,t(o);break}o.clear()}},testHeroItems:function(e){for(var t=0;t<level.items.length;++t)level.items[t].visible&&Physics.isSATcollision(hero,level.items[t],function(o){e(o,t)})},handleScale:function(){for(var e=0,t=0;t<level.objs.length;++t)level.objs[t].type===JQObject.SCALE&&void 0!==level.objs[t].holdingItem&&null!==level.objs[t].holdingItem&&level.objs[t].holdingItem.type===JQObject.CRATE&&++e;var o=2===e;return o&&(audio.discovery.play(),$.grep(level.objs,function(e){return e.type===JQObject.LADDER})[0].visible=!0),o}};const JQObject=Object.freeze({EMPTY:0,CRATE:1,LADDER:2,SACK:3,ENEMY:4,CASH:5,DOOR:6,SCALE:7,CLOUD:8,PLATFORM:9,SHURIKEN:10,SLOPE:11,POLY:12,HILL:13,ELEVATOR:14,SCALEBG:15,FIREBALL:16}),JQObject_names=Object.freeze({0:\"EMPTY\",1:\"CRATE\",2:\"LADDER\",3:\"SACK\",4:\"ENEMY\",5:\"CASH\",6:\"DOOR\",7:\"SCALE\",8:\"CLOUD\",9:\"PLATFORM\",10:\"SHURIKEN\",11:\"SLOPE\",12:\"POLY\",13:\"HILL\",14:\"ELEVATOR\",15:\"SCALEBG\",16:\"FIREBALL\"});var GameObj=function(e,t,o,l,i,r,s){if(this.dir=s,e===JQObject.PLATFORM||e===JQObject.ELEVATOR?$.extend(this,Graphics.getSkewedRect(t,o,l,i)):e===JQObject.SLOPE?$.extend(this,Graphics.getStairPoly(t,o,l,i,s)):e===JQObject.HILL?$.extend(this,Graphics.getHill(t,o,l,i)):e===JQObject.POLY||$.extend(this,new SAT.Box(new SAT.Vector(t,o),l,i).toPolygon()),this.type=e,this.imgReady=!1,void 0===r||null===r)this.w=l,this.h=i;else{this.w=l,this.h=i,this.img=new Image;var n=this;this.img.onload=function(){n.imgReady=!0,n.w=this.width,n.h=this.height},this.img.src=`img/${r}`}};GameObj.prototype={draw:function(){this.imgReady?ctx.drawImage(this.img,this.pos.x,this.pos.y):(this.type===JQObject.SCALEBG?ctx.fillStyle=Color.LIGHT_BROWN:this.type===JQObject.FIREBALL?ctx.fillStyle=\"orange\":ctx.fillStyle=\"red\",ctx.fillRect(this.pos.x,this.pos.y,this.w,this.h))}};var GameItem=function(e,t,o,l){utils.extend(this,e),this.grabbable=void 0!==t&&t,this.val=void 0!==o?o:-1,this.visible=void 0===l||l,this.vY=0,this.isOnObj=!1,this.onObj=null,this.isBeingHeld=!1;var i=this.draw;this.draw=function(){this.visible&&i.apply(this)}};class Hud{constructor(){this.cash=new GameObj(JQObject.EMPTY,548,FULLH+20,22,24,\"cash.png\"),this.medKit=new GameObj(JQObject.EMPTY,238,FULLH+15,31,30,\"medKit.png\"),this.shuriken=new GameObj(JQObject.EMPTY,447,FULLH+15,31,31,\"shuriken.png\"),this.syringe=new GameObj(JQObject.EMPTY,342,FULLH+18,25,25,\"syringe.png\")}drawHealth(){for(let e=0;e<hero.health;++e)ctx.fillStyle=\"red\",ctx.fillRect(77+21*e,FULLH+8,19,8)}drawMana(){for(let e=0;e<hero.mana;++e)ctx.fillStyle=\"#00b6ff\",ctx.fillRect(77+21*e,FULLH+26,19,8)}drawXP(){ctx.fillStyle=\"#ddd\",ctx.font='12px \"Press Start 2P\"';const e=hero.xp<10?\"0\":\"\";ctx.fillText(`${e}${hero.xp}/${hero.xpNeeded}`,77,FULLH+54)}draw(){ctx.fillStyle=\"#070707\",ctx.fillRect(0,FULLH,FULLW,game.padHUD),ctx.fillStyle=\"#ddd\",ctx.font='11px \"Press Start 2P\"',ctx.fillText(`HP-${hero.healthLvl}`,7,FULLH+18),ctx.fillText(`MP-${hero.manaLvl}`,7,FULLH+37),ctx.fillText(\"XP\",7,FULLH+54),this.drawHealth(),this.drawMana(),this.drawXP(),ctx.fillText(hero.medKits,210,FULLH+37),this.medKit.draw(),ctx.fillText(hero.manaKits,315,FULLH+37),this.syringe.draw(),ctx.fillText(hero.ammo,410,FULLH+37),this.shuriken.draw(),ctx.fillText(hero.cash,515,FULLH+37),this.cash.draw(),ctx.fillText(`LIVES x${hero.lives}`,700,FULLH+37);let e=utils.getTimeObj(game.actualTime);ctx.fillText(e.min+\":\"+e.sec,FULLW-78,FULLH+24)}}const JQEnemy=Object.freeze({STILL:0,PATROL:1,FOLLOW:2});var Enemy=function(e,t,o,l,i,r){utils.extend(this,e),this.initX=this.pos.x,this.initY=this.pos.y,this.initHealth=this.health=o,this.enemy_t=t,this.leftXBound=l,this.rightXBound=i,this.active=void 0!==r&&r,this.deadOffScreen=!1,this.dir=Dir.RIGHT,this.alive=!0,this.deadOnScreen=!1,this.clearDir=Dir.RIGHT;var s=this;var n=this.draw;this.draw=function(){var e;(this.alive||this.deadOnScreen)&&(this.initHealth>1&&(e=s.w/s.initHealth*s.health,ctx.fillStyle=\"red\",ctx.fillRect(s.pos.x,s.pos.y-12,e,4)),ctx.save(),this.deadOnScreen&&(ctx.globalAlpha=.3),n.apply(this),ctx.restore())}};Enemy.prototype={update:function(){this.deadOnScreen?this.enemy_t===JQEnemy.STILL?(this.deadOnScreen=!1,this.deadOffScreen=!0):(this.pos.x+=this.clearDir===Dir.RIGHT?2:-2,this.pos.y-=9,(this.pos.x<0||this.pos.x>FULLW)&&(this.deadOnScreen=!1,this.deadOffScreen=!0)):this.active&&game.totalTicks%3==0&&this.movement()},movement:function(){this.enemy_t===JQEnemy.PATROL?(this.pos.x+hero.lvlX<=this.leftXBound?this.dir=Dir.RIGHT:this.pos.x+hero.lvlX>=this.rightXBound&&(this.dir=Dir.LEFT),this.dir===Dir.RIGHT?++this.pos.x:--this.pos.x):this.enemy_t===JQEnemy.FOLLOW&&(this.pos.x<hero.pos.x?++this.pos.x:this.pos.x>hero.pos.x&&--this.pos.x)},death:function(){this.clearDir=hero.dir,audio.enemyDeath.play(),hero.xp+=15,this.alive=!1,this.deadOnScreen=!0},revive:function(){this.health=this.initHealth,this.deadOffScreen=!1,this.deadOnScreen=!1,this.alive=!0}};var level=(()=>{var e=10;return{bgColor:{},bg:[],objs:[],items:[],enemies:[],curLvl:null,isCutscene:!1,time:0,hiddenItemsFound:0,hiddenItems:0,isTransitioning:!1,init:()=>{level.reset(),level.curLvl=new StartScreen},reset:function(){game.over=!1,game.actualTime=0,level.hiddenItemsFound=0,hero.lvlX=0,level.bgColor={fillStyle:\"#000\"},level.bg=[],level.objs=[],level.items=[],level.enemies=[],hero.pos.x=23,hero.pos.y=FULLH-game.padFloor-hero.h+4,hero.vX=hero.vY=0,hero.isJumping=!1,hero.ammo=20,hero.bulletArr.length=0,hero.invincible=!1,hero.isHolding=!1,hero.curItem=null,hero.dir=Dir.RIGHT,hero.health=hero.maxHealth},complete:function(){level.isTransitioning=!0,audio.lvlComplete(),Graphics.ticker=1,Graphics.fadeOut=!0,Graphics.fadeCanvas(function(){level.isTransitioning=!1,level.curLvl=lvlComplete,level.isCutscene=!0,level.time=game.actualTime})},update:function(){if(!level.isTransitioning){if(0!=game.lvl){!function(){for(var t=0;t<level.items.length;++t)level.items[t].visible&&!level.items[t].isOnObj&&(level.items[t].vY<e?level.items[t].vY+=game.gravity:level.items[t].vY=e,Physics.testObjObjs(level.items[t],function(e){e.a.pos.x-=e.overlapV.x,e.a.pos.y-=e.overlapV.y,1===e.overlapN.y&&(audio.thud.play(),e.a.vY=e.b.type===JQObject.ELEVATOR?e.b.vY:0,e.a.isOnObj=!0,e.a.onObj=e.b,e.a.recentlyHeld=!1,e.b.type===JQObject.SCALE&&null===e.b.holdingItem&&(e.a.grabbable=!1,e.b.holdingItem=e.a,utils.repeatAction(42,14,function(){e.b.side===Dir.LEFT?(++e.a.pos.y,++e.b.pos.y,++e.b.hBar.pos.y,--e.b.otherSide.pos.y,--e.b.hBar.y2,null!==e.b.otherSide.holdingItem&&--e.b.otherSide.holdingItem.pos.y):(++e.a.pos.y,++e.b.pos.y,++e.b.hBar.y2,--e.b.hBar.pos.y,--e.b.otherSide.pos.y,null!==e.b.otherSide.holdingItem&&--e.b.otherSide.holdingItem.pos.y)})))}),Physics.testItemItems(level.items[t],function(e){e.a.isOnObj=!0,e.a.onObj=e.b,e.b.grabbable=!1,e.a.recentlyHeld=!1})),void 0!==level.items[t].onObj&&null!==level.items[t].onObj&&(level.items[t].vY=level.items[t].onObj.type===JQObject.ELEVATOR?level.items[t].onObj.vY:0),level.items[t].pos.y+=level.items[t].vY}(),function(){for(var e=0;e<level.enemies.length;++e)if(level.enemies[e].update(),level.enemies[e].health>0){SAT.testPolygonPolygon(hero,level.enemies[e])&&(level.enemies[e].active=!0,hero.invincible||(audio.play(audio.heartbeat,!0),hero.invincible=!0,--hero.health));for(var t=0;t<hero.bulletArr.length;++t)SAT.testPolygonPolygon(hero.bulletArr[t],level.enemies[e])&&(audio.play(audio.thud,!0),level.enemies[e].active=!0,hero.bulletArr.splice(t,1),--level.enemies[e].health,level.enemies[e].health<=0&&level.enemies[e].death())}}();for(var t=level.bg.length;t--;){var o=.5/level.bg[t].speed;level.bg[t].pos.x-=o,level.bg[t].distTraveled+=o,level.bg[t].distTraveled>level.bg[t].distToTravel&&(level.bg.splice(t,1),Graphics.spawnCloud(level.curLvl.width))}}level.curLvl.update()}},updateView:()=>{!function(){for(var e=0;e<level.objs.length;++e)level.objs[e].pos.x-=hero.vX,level.objs[e].type===JQObject.SCALEBG&&(level.objs[e].x2-=hero.vX)}(),function(){for(var e=0;e<level.items.length;++e)level.items[e].pos.x-=hero.vX}(),function(){level.bgColor.gradX-=hero.vX,level.bgColor.fillStyle=Graphics.getDoorBgGrad();for(var e=0;e<level.bg.length;++e){var t=hero.vX/level.bg[e].speed;level.bg[e].pos.x-=t,level.bg[e].distTraveled+=t}}(),function(){for(var e=0;e<level.enemies.length;++e)level.enemies[e].pos.x-=hero.vX}()},render:()=>{!function(){ctx.fillStyle=\"#000\",ctx.fillRect(0,FULLH-game.padFloor,FULLW,game.padFloor),ctx.fillStyle=level.bgColor.fillStyle,ctx.fillRect(0,0,FULLW,FULLH-game.padFloor);for(var e=0;e<level.bg.length;++e){var t=level.bg[e],o=utils.speed2scale(t.speed);ctx.drawImage(t.img,t.pos.x,t.pos.y,t.w*o,t.h*o)}}(),function(){for(var e=0;e<level.objs.length;++e){var t=level.objs[e];(void 0===t.visible||t.visible)&&(t.type===JQObject.LADDER?Graphics.drawLadder(t):t.type===JQObject.SCALE?(Graphics.drawScale(t),Graphics.drawPlatformStatus(t)):t.type===JQObject.PLATFORM||t.type===JQObject.SLOPE||t.type===JQObject.ELEVATOR?Graphics.drawPlatform(t):t.type===JQObject.DOOR?Graphics.drawDoor(t):t.type===JQObject.POLY?Graphics.drawPoly(t):t.type===JQObject.HILL?Graphics.drawHill(t):t.draw())}}(),function(){for(var e=0;e<level.items.length;++e)level.items[e].draw()}(),function(){for(var e=0;e<level.enemies.length;++e)level.enemies[e].deadOffScreen||level.enemies[e].draw()}(),level.curLvl.render()}}})(),lvlComplete=(()=>{function e(e){lastKeyDown=KeyCode.EMPTY,level.reset(),null!=e?game.lvl=e:++game.lvl,function(e){switch(e){case 1:lvl1.init(),level.curLvl=lvl1;break;case 2:lvl2.init(),level.curLvl=lvl2;break;case 3:var t=new Level3;level.curLvl=t}audio.updateBgMusic()}(game.lvl),level.isCutscene=!1}return{update:function(){window.DEBUG?e(window.DEBUG_OPT.lvl):(keysDown[KeyCode.ENTER]||0===game.lvl)&&e()},render:function(){ctx.fillStyle=\"#000\",ctx.fillRect(0,0,FULLW,canvas.height),ctx.font=\"24px 'Press Start 2P'\";var e=\"LEVEL \"+game.lvl+\" COMPLETE\",t=ctx.measureText(e).width;ctx.fillStyle=Color.ORANGE,ctx.fillText(e,HALFW-t/2,70),ctx.font=\"18px 'Press Start 2P'\";var o=utils.getTimeObj(level.time),l=\"LEVEL TIME......\"+o.min+\":\"+o.sec;ctx.measureText(l).width;ctx.fillStyle=\"#e1e1e1\",ctx.fillText(l,HALFW-t/2,150),ctx.font=\"18px 'Press Start 2P'\";var i=\"HIDDEN ITEMS.....\"+level.hiddenItemsFound+\"/\"+level.hiddenItems,r=ctx.measureText(i).width;ctx.fillStyle=\"#e1e1e1\",ctx.fillText(i,HALFW-r/2,190),Graphics.blinkText(16,HALFW,HALFH+120)}}})();function StartScreen(){this.width=FULLW,level.isCutscene=!0}StartScreen.prototype=function(){var e=String.fromCharCode(\"169\")+\" 2017 JON WIEDMANN\";return{update:function(){lastKeyDown===KeyCode.ENTER&&level.complete()},render:function(){ctx.font=\"29px 'Press Start 2P'\";var t=HALFW-ctx.measureText(\"JON'S\").width/2+11,o=58;ctx.setTransform(1,0,-.4,1.4,0,0),ctx.fillStyle=\"#222\",ctx.fillText(\"J\",t+4,o+3),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"J\",t,o),ctx.setTransform(1,0,-.2,1.4,0,0),ctx.fillStyle=\"#222\",ctx.fillText(\"O\",t+32,o+3),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"O\",t+28,o),ctx.setTransform(1,0,.05,1.41,0,-1),ctx.fillStyle=\"#222\",ctx.fillText(\"N\",t+58,o+3),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"N\",t+54,o),ctx.setTransform(1,0,.23,1.4,0,0),ctx.fillStyle=\"#222\",ctx.fillText(\"'\",t+78,o+3),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"'\",t+74,o),ctx.setTransform(1,0,.42,1.4,0,0),ctx.fillStyle=\"#222\",ctx.fillText(\"S\",t+95,o+3),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"S\",t+91,o),ctx.font=\"36px 'Press Start 2P'\",t=HALFW-ctx.measureText(\"QUEST\").width/2+30,o=98,ctx.setTransform(1,0,-.5,1.6,0,0),ctx.fillStyle=\"#222\",ctx.fillText(\"Q\",t+4,o+3),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"Q\",t,o),ctx.setTransform(1,0,-.25,1.6,0,0),ctx.fillStyle=\"#222\",ctx.fillText(\"U\",t+26,o+3),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"U\",t+22,o),ctx.setTransform(1,0,.03,1.6,0,0),ctx.fillStyle=\"#222\",ctx.fillText(\"E\",t+50,o+3),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"E\",t+46,o),ctx.setTransform(1,0,.25,1.6,0,0),ctx.fillStyle=\"#222\",ctx.fillText(\"S\",t+74,o+3),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"S\",t+70,o),ctx.setTransform(1,0,.5,1.6,0,0),ctx.fillStyle=\"#222\",ctx.fillText(\"T\",t+90,o+4),ctx.fillStyle=\"#ff6a00\",ctx.fillText(\"T\",t+86,o),ctx.setTransform(1,0,0,1,0,0),Graphics.blinkText(22,HALFW,HALFH+81),ctx.fillStyle=\"#000\",ctx.fillRect(0,FULLH,FULLW,game.padHUD),ctx.font=\"13px 'Press Start 2P'\",ctx.fillStyle=\"#c9c9c9\",ctx.fillText(e,HALFW-ctx.measureText(e).width/2,FULLH+24)}}}();var lvl1=(()=>{var e,t,o,l=!1,i={};return{width:2710,init:function(){var l;level.hiddenItems=1,function(){level.objs.push(new GameObj(JQObject.PLATFORM,-Graphics.projectX,FULLH-game.padFloor-1,lvl1.width+2*Graphics.projectX,game.padFloor+1),new GameObj(JQObject.PLATFORM,200,206,267,62),new GameObj(JQObject.PLATFORM,575,310,300,62),new GameObj(JQObject.PLATFORM,605,125,220,62)),i=Graphics.getScale(1500,FULLH-game.padFloor-137),level.objs.push(i.vBar,i.hBar,i[Dir.LEFT],i[Dir.RIGHT]);var e=new GameObj(JQObject.SLOPE,2203,208,252,62,null,Dir.UP_RIGHT),l=new GameObj(JQObject.PLATFORM,e.pos.x+e.w-11,e.pos.y-e.h-5,200,62);t=new GameObj(JQObject.DOOR,l.pos.x+l.w-63,l.pos.y-62-Graphics.projectY/2,33,62),level.objs.push(l,e,t),(o=new GameItem(new GameObj(JQObject.LADDER,e.pos.x-37,e.pos.y-1,38,FULLH-e.pos.y-game.padFloor),!1,0,!1)).collidable=!1,level.objs.push(o)}(),function(){var t=[];for(let e=0;e<3;++e)t.push(new GameItem(new GameObj(JQObject.CRATE,446,FULLH-game.padFloor-26+5,34,37,\"crate.png\"),!0));t[1].pos.x=i[Dir.LEFT].pos.x+i[Dir.LEFT].w/2-t[0].w/2,t[2].pos.x=i[Dir.RIGHT].pos.x+i[Dir.RIGHT].w/2-t[0].w/2;var o=new GameItem(new GameObj(JQObject.SACK,680,111+Graphics.projectY/2,30,34,\"sack.png\"),!1,5);e=new GameItem(new GameObj(JQObject.CASH,113,80,22,24,\"cash.png\"),!1,10,!1),level.items.push(t[0],t[1],t[2],o,e)}(),(l=new Enemy(new GameObj(JQObject.ENEMY,1200,FULLH-game.padFloor-55+Graphics.projectY/2,40,55,\"cyborgBnW.png\"),JQEnemy.FOLLOW,1,1087,1600,!1)).collidable=!1,level.enemies.push(l),level.bgColor.gradX=t.pos.x+t.w/2,level.bgColor.gradY=t.pos.y+t.h/2,level.bgColor.c0=\"rgb(203,163,0)\",level.bgColor.c1=\"#1F7DCF\",level.bgColor.fillStyle=Graphics.getDoorBgGrad(),Graphics.setClouds(lvl1.width)},deinit:function(){e=null,t=null,o=null,l=!1},update:function(){if(l?hero.onLadder=SAT.testPolygonPolygon(hero,o):l=Physics.handleScale(),!e.visible)for(var i=0;i<hero.bulletArr.length;++i)Physics.isCollision(hero.bulletArr[i],e,-17)&&(e.visible=!0,audio.discovery.play(),++level.hiddenItemsFound);!game.over&&Physics.isCollision(hero,t,0)&&level.complete()},render:()=>{Graphics.drawScaleBg(i)}}})(),lvl2=(()=>{var e,t,o,l,i,r,s,n,a,c,h,d,p=[],u=null,v={},m=!1,x=!1;function b(){var e=new Enemy(new GameObj(JQObject.ENEMY,l.pos.x+l.w,404,40,55,\"cyborgBnW.png\"),JQEnemy.PATROL,1,l.pos.x+l.w,i.pos.x-27.5,!0);e.collidable=!0,level.enemies.push(e),en=new Enemy(new GameObj(JQObject.ENEMY,s.pos.x+35,s.pos.y-55,40,55,\"cyborgBnW.png\"),JQEnemy.STILL,5),en.collidable=!0,d=en,(h=new GameObj(JQObject.EMPTY,d.pos.x,d.pos.y,d.w,d.h)).collidable=!1,h.visible=!1,level.objs.push(h),level.enemies.push(d)}return{width:5030,init:()=>{level.hiddenItems=0,function(){e=new GameObj(JQObject.PLATFORM,-Graphics.projectX,FULLH-game.padFloor,FULLW-250,game.padFloor),t=new GameObj(JQObject.HILL,200,FULLH-game.padFloor,320,60),o=new GameObj(JQObject.PLATFORM,e.pos.x+e.w-Graphics.projectX,e.pos.y-e.h-30,1e3,180),l=new GameObj(JQObject.PLATFORM,o.pos.x+240,o.pos.y-90+Graphics.projectY,100,85),i=new GameObj(JQObject.PLATFORM,o.pos.x+o.w-100,o.pos.y-90+Graphics.projectY,100,85),r=new GameObj(JQObject.PLATFORM,l.pos.x+140,l.pos.y-137,480,30),level.objs.push(o,e,t,l,i,r);for(var h=0;h<3;++h)p[h]=new GameObj(JQObject.ELEVATOR,i.pos.x+237+300*h,i.pos.y-80*h,115,26),p[h].dir=Dir.DOWN,level.objs.push(p[h]);s=new GameObj(JQObject.PLATFORM,p[2].pos.x+p[2].w+120,190,100,FULLH-190),n=new GameObj(JQObject.SLOPE,s.pos.x+s.w-Graphics.projectX,s.pos.y,900,FULLH-190,null,Dir.DOWN_RIGHT);var d=new GameObj(JQObject.PLATFORM,n.pos.x+n.w-Graphics.projectX-1,FULLH-game.padFloor,1e3,game.padFloor);v=Graphics.getScale(d.pos.x+250,FULLH-game.padFloor-137),level.objs.push(v.hBar,v.vBar,v[Dir.LEFT],v[Dir.RIGHT]),(a=new GameObj(JQObject.LADDER,d.pos.x+d.w-Graphics.projectX-30,140,30,FULLH-140-game.padFloor)).visible=!1,a.collidable=!1;var u=new GameObj(JQObject.PLATFORM,a.pos.x+a.w,140,350,game.padFloor);c=new GameObj(JQObject.DOOR,u.pos.x+u.w-90,u.pos.y-100,40,100),level.objs.push(d,n,s,u,c,a)}(),function(){var e=new GameItem(new GameObj(JQObject.CRATE,r.pos.x+r.w/2-80,r.pos.y-37,34,37,\"crate.png\"),!0),t=new GameItem(new GameObj(JQObject.CRATE,r.pos.x+r.w/2+80,r.pos.y-37,34,37,\"crate.png\"),!0),o=new GameItem(new GameObj(JQObject.SACK,l.pos.x+300,302,30,36,\"sack.png\"),!0,5);level.items.push(o,e,t)}(),b(),level.bgColor.gradX=c.pos.x,level.bgColor.gradY=c.pos.y,level.bgColor.c0=\"rgb(203,163,0)\",level.bgColor.c1=\"#1F7DCF\",level.bgColor.fillStyle=Graphics.getDoorBgGrad(),Graphics.setClouds(lvl2.width)},deinit:()=>{x=!1},update:function(){for(var e=0;e<p.length;++e)p[e].dir===Dir.UP&&p[e].pos.y<100?p[e].dir=Dir.DOWN:p[e].dir===Dir.DOWN&&p[e].pos.y>400&&(p[e].dir=Dir.UP),p[e].vY=p[e].dir===Dir.DOWN?1:-1,p[e].pos.y+=p[e].vY;var t;h.pos.x+h.w>=0&&h.pos.x+h.w<=FULLW?(m&&(m=!1,d.revive()),d.alive&&null===u&&(t=hero.pos.x<d.pos.x?Dir.LEFT:Dir.RIGHT,(u=new GameObj(JQObject.FIREBALL,d.pos.x,d.pos.y,20,20,null,t)).tag=level.objs.length,u.collidable=!1,level.objs.push(u))):d.alive||(m=!0),null!==u&&(u.dir===Dir.LEFT?--u.pos.x:++u.pos.x,(u.pos.x<=0||u.pos.x>=FULLW)&&(level.objs.splice(u.tag,1),u=null)),!hero.invincible&&null!==u&&SAT.testPolygonPolygon(hero,u)&&(level.objs.splice(u.tag,1),u=null,audio.play(audio.heartbeat,!0),hero.invincible=!0,--hero.health),x?hero.onLadder=SAT.testPolygonPolygon(hero,a):x=Physics.handleScale(),SAT.testPolygonPolygon(hero,c)&&level.complete()},render:()=>{Graphics.drawScaleBg(v)}}})();function Level3(){this.init()}Level3.prototype=(()=>{var e;return{width:1008,init:function(){var t;level.hiddenItems=0,t=new GameObj(JQObject.PLATFORM,-Graphics.projectX,FULLH-game.padFloor,1050,game.padFloor),level.objs.push(t),(e=new Enemy(new GameObj(JQObject.ENEMY,400,FULLH-game.padFloor-160,120,165,\"cyborgBnW_boss.png\"),JQEnemy.PATROL,1,200,500,!0)).collidable=!0,level.enemies.push(e),function(){level.bgColor.gradX=1400,level.bgColor.gradY=180,level.bgColor.c0=\"#222\",level.bgColor.c1=\"#333\";var e=ctx.createRadialGradient(level.bgColor.gradX,level.bgColor.gradY,14,level.bgColor.gradX,level.bgColor.gradY,440);e.addColorStop(0,level.bgColor.c0),e.addColorStop(1,level.bgColor.c1),level.bgColor.fillStyle=e,Graphics.setClouds(Level3.prototype.width)}()},deinit:function(){},update:function(){},render:function(){ctx.fillStyle=\"#fff\",ctx.font=\"22px 'Press Start 2P'\",ctx.fillText(\"LEVEL 3 -- BOSS BATTLE COMING SOON!!\",150,280)}}})();let game=(()=>{var e,t,o=0,l=0,i=16,r=[60];function s(t){t-l>0&&(i=t-l),l=t,e=requestAnimationFrame(s),level.render(),level.isCutscene||(game.over||hero.render(),HUD.draw(),function(e){if(r.push(1e3/i),game.totalTicks%120==0){for(var t=0,l=r.length;--l;)t+=r[l];for(o=r.length>0?Math.floor(t/r.length):0;r.length>0;)r.pop()}ctx.fillStyle=\"#ddd\",ctx.font='11px \"Press Start 2P\"',ctx.fillText(`${o} FPS`,FULLW-77,FULLH+50)}())}return{over:!1,gravity:.13,padHUD:58,padFloor:16,lvl:0,totalTicks:0,actualTime:0,start:function(){t=setInterval(function(){++game.totalTicks,Graphics.ticker+=Graphics.fadeOut?-Graphics.tickerStep:Graphics.tickerStep,level.isCutscene||level.isTransitioning||game.over||hero.update(),level.update()},8.3333),s()},stop:function(){window.cancelAnimationFrame(e),clearInterval(t)}}})();var Shuriken={w:31,h:31,speed:4.4},hero=(()=>{var e=null,t=null,o=null,l=!1,i=null,r=[],s=170,n=170;return{sx:0,sy:0,lvlX:0,w:48,h:65,vX:0,vY:0,aX:.17,aY:.82,jumpMod:4,jumpMod0:4,idleTime:0,dir:Dir.RIGHT,onLadder:!1,invincible:!1,isJumping:!1,isHolding:!1,isOnObj:!0,curItem:null,lives:3,health:3,maxHealth:3,medKits:1,healthLvl:1,mana:0,maxMana:4,manaKits:1,manaLvl:1,ammo:20,cash:0,lvl:1,xp:0,xpNeeded:50,bulletArr:[],init:function(){(i=new Image).onload=(()=>{l=!0}),i.src=\"img/sprites/player/player.png\",$.get(\"img/sprites/player/player.xml\",function(e){let t=$(e).find(\"sprite\");$(t).each(function(){let e=$(this).attr(\"n\"),t=$(this).attr(\"x\"),o=$(this).attr(\"y\");e=e.substring(0,e.length-4),r[e]={x:t,y:o}})}),e=HeroInputComponent(),o=HeroPhysicsComponent(),t=new HeroGraphicsComponent,$.extend(hero,new SAT.Box(new SAT.Vector(0,0),hero.w,hero.h).toPolygon())},update:()=>{e.check(),o.updatePosition(),o.checkCollision(),hero.invincible&&--s,s<=0&&(hero.invincible=!1,s=n),hero.health<=0&&!game.over&&utils.deathSequence(),function(){let e={x:0,y:0};if(hero.isHolding&&0===hero.vX)e=r.playerDown;else if(hero.onLadder)e=r.playerUp;else if(hero.dir===Dir.RIGHT||hero.dir===Dir.LEFT){let t=hero.dir===Dir.RIGHT,o=\"player\"+(t?\"Right\":\"Left\");if(t&&hero.vX>0||!t&&hero.vX<0){let t=game.totalTicks%96;hero.isOnObj?Math.abs(hero.vX)<=10*hero.aX?e=r[o+\"_Step\"]:t>=0&&t<24?(e=r[o+\"_Run1\"],hero.isJumping||audio.step.play()):t>=24&&t<48?e=r[o+\"_Run2\"]:t>=48&&t<72?(e=r[o+\"_Run3\"],hero.isJumping||audio.step.play()):e=r[o+\"_Run2\"]:e=r[o+\"_Run1\"]}else e=r[o]}if(hero.onLadder||0!==hero.vX||0!==hero.vY?(hero.idleTime=0,hero.isHolding&&(hero.curItem.pos.y=hero.pos.y+20)):++hero.idleTime,hero.idleTime>210){var t=hero.idleTime%200;t>=0&&t<=50||t>100&&t<=150?e=r.playerDown:t>50&&t<=100?(e=r.playerDown_breatheIn,hero.isHolding&&(hero.curItem.pos.y=hero.pos.y+18)):t>150&&t<=200&&(e=r.playerDown_breatheOut,hero.isHolding&&(hero.curItem.pos.y=hero.pos.y+22))}const o=s%40;hero.invincible&&o>=0&&o<=16&&(e={x:-1,y:-1}),hero.sx=e.x,hero.sy=e.y}()},render:()=>{l&&hero.sx>=0&&hero.sy>=0&&ctx.drawImage(i,hero.sx,hero.sy,hero.w,hero.h,Math.round(hero.pos.x),Math.round(hero.pos.y),hero.w,hero.h),t.drawBullets(),hero.isHolding&&hero.curItem.draw()},landed:e=>{hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0,hero.pos.y-=e}}})();class HeroGraphicsComponent{constructor(){this.shurikenReady=!1,this.shuriken=new Image,this.shuriken.src=\"img/shuriken.png\",this.shuriken.onload=(()=>{this.shurikenReady=!0})}drawBullets(){for(let e of hero.bulletArr){let t=e.dirR?hero.w:0;e.deg+=5,this.shurikenReady&&Graphics.drawRotate(this.shuriken,e.pos.x+t,e.pos.y+20,e.deg)}}}var HeroPhysicsComponent=function(){return{updatePosition:function(){if((hero.dir===Dir.RIGHT&&hero.pos.x>=HALFW+35||hero.dir===Dir.LEFT&&hero.pos.x<=HALFW-45)&&hero.lvlX+hero.vX>=0&&hero.lvlX+hero.vX<=level.curLvl.width-FULLW){hero.lvlX+=hero.vX;for(var e=0;e<hero.bulletArr.length;++e)hero.bulletArr[e].pos.x-=hero.vX;level.updateView()}else hero.pos.x+=hero.vX;hero.onLadder||(hero.pos.y+=hero.vY)},checkCollision:()=>{!function(){for(var e=0;e<hero.bulletArr.length;++e)hero.bulletArr[e].pos.x+=hero.bulletArr[e].dirR?Shuriken.speed:-Shuriken.speed,hero.bulletArr[e].pos.x>FULLW||hero.bulletArr[e].pos.x<0?hero.bulletArr.splice(e,1):Physics.testObjObjs(hero.bulletArr[e],()=>{hero.bulletArr.splice(e,1)})}(),hero.pos.y<2*-hero.h?(hero.pos.y=2*-hero.h,hero.vY=0):hero.pos.y>=FULLH+2*hero.h&&(game.over||utils.deathSequence()),hero.pos.x<0?(hero.pos.x=0,hero.vX=0):hero.pos.x>FULLW-hero.w&&(hero.pos.x=FULLW-hero.w,hero.vX=0),hero.isOnObj=!1,Physics.testObjObjs(hero,function(e){var t={x:Dir.NONE,y:Dir.NONE};1===e.overlapN.y?t.y=Dir.TOP:-1===e.overlapN.y&&(t.y=Dir.BOT),1===e.overlapN.x?t.x=Dir.LEFT:-1===e.overlapN.y&&(t.x=Dir.RIGHT),e.b.type===JQObject.SLOPE||e.b.type===JQObject.POLY||e.b.type===JQObject.HILL?hero.vY>=0&&hero.landed(e.overlapV.y):e.b.type===JQObject.ELEVATOR?t.y===Dir.TOP&&hero.vY>=0&&(hero.isOnObj=!0,hero.isJumping=!1,hero.vY=e.b.vY>0?e.b.vY:0,e.a.pos.y-=e.overlapV.y):(e.a.pos.x-=e.overlapV.x,t.y===Dir.TOP&&hero.vY>=0?hero.landed(e.overlapV.y):t.y===Dir.BOT&&hero.vY<=0&&(hero.vY=0,e.a.pos.y-=e.overlapV.y))}),hero.isHolding&&(0===hero.vX?(hero.curItem.pos.x=hero.pos.x+7,hero.curItem.pos.y=hero.pos.y+20):(hero.curItem.pos.x=hero.pos.x+(hero.dir===Dir.RIGHT?45:-32),hero.curItem.pos.y=hero.pos.y+16)),Physics.testHeroItems(function(e,t){e.b.type===JQObject.CRATE?1===e.overlapN.y?(hero.pos.y-=e.overlapV.y,hero.isOnObj=!0,hero.isJumping=!1,hero.vY=0,void 0!==e.b.onObj&&null!==e.b.onObj&&e.b.onObj.type===JQObject.ELEVATOR&&(hero.vY=e.b.vY)):hero.isHolding||!e.b.grabbable||e.b.recentlyHeld||(!0===e.b.isOnObj&&(e.b.isOnObj=!1,null!==e.b.onObj&&(e.b.onObj.grabbable=!0,e.b.onObj=null)),e.b.isBeingHeld=!0,hero.curItem=e.b,hero.isHolding=!0,level.items.splice(t,1)):(audio.itemPickedUp.play(),e.b.type===JQObject.SACK?hero.ammo+=e.b.val:e.b.type===JQObject.CASH&&(hero.cash+=e.b.val),level.items.splice(t,1))})}}};const KeyCode=Object.freeze({ENTER:13,CTRL:17,A:65,D:68,F:70,H:72,J:74,K:75,M:77,O:79,R:82,S:83,W:87,EMPTY:-1,SPACEBAR:32});var HeroInputComponent=function(){return keysDown={},lastKeyDown=-1,$(document).on(\"click\",\".resize\",function(){$(this).hasClass(\"off\")?($(this).removeClass(\"off\").addClass(\"on\"),$(this).children(\"iron-icon\").prop(\"icon\",\"i:fullscreen-exit\")):$(this).hasClass(\"on\")&&($(this).removeClass(\"on\").addClass(\"off\"),$(this).children(\"iron-icon\").prop(\"icon\",\"i:fullscreen\")),utils.toggleFullScreen()}),addEventListener(\"keydown\",function(e){if(e.keyCode===KeyCode.SPACEBAR)e.preventDefault();else if(e.keyCode===KeyCode.M)audio.handleMuteButton();else if(e.keyCode===KeyCode.F)$(\".resize\").trigger(\"click\");else if(e.keyCode!==KeyCode.K||hero.isJumping||lastKeyDown===KeyCode.K&&keysDown[KeyCode.K]||!hero.isOnObj){if(e.keyCode!==KeyCode.J||lastKeyDown==KeyCode.J&&keysDown[KeyCode.J])e.keyCode==KeyCode.O&&utils.toggleMenu();else if(hero.ammo>0&&!hero.isHolding){audio.play(audio.effort);var t=new GameObj(JQObject.SHURIKEN,hero.pos.x,hero.pos.y+Shuriken.h/2,Shuriken.w,Shuriken.h);t.dirR=hero.dir===Dir.RIGHT,t.deg=0,hero.bulletArr.push(t),--hero.ammo,hero.idleTime=0}}else audio.jump.play(),hero.vY=0,hero.isJumping=!0,hero.isOnObj=!1;lastKeyDown=e.keyCode,keysDown[e.keyCode]=!0},!1),addEventListener(\"keyup\",function(e){delete keysDown[e.keyCode]},!1),{check:function(){var e=!1;if(hero.isJumping?hero.jumpMod>0?hero.vY-=hero.aY*hero.jumpMod--:e=!0:(hero.jumpMod=hero.jumpMod0,e=!0),e&&!hero.onLadder){var t=hero.vY+2*game.gravity;hero.vY=t>10?10:t}var o=!1;keysDown[KeyCode.A]&&(hero.vX=Math.abs(hero.vX-hero.aX)>3?-3:hero.vX-hero.aX,hero.dir=Dir.LEFT,o=!0),keysDown[KeyCode.D]&&(hero.vX=Math.abs(hero.vX+hero.aX)>3?3:hero.vX+hero.aX,hero.dir=Dir.RIGHT,o=!0),Math.abs(hero.vX)<hero.aX?hero.vX=0:o||(hero.vX/=1.26),keysDown[KeyCode.W]&&hero.onLadder&&--hero.pos.y,keysDown[KeyCode.S]&&hero.onLadder&&++hero.pos.y,keysDown[KeyCode.SPACEBAR]&&hero.isHolding&&(hero.isHolding=!1,hero.curItem.isBeingHeld=!1,hero.curItem.recentlyHeld=!0,level.items.push(hero.curItem),hero.curItem=null),keysDown[KeyCode.H]&&hero.medKits>0&&hero.health<hero.maxHealth&&(++hero.health,--hero.medKits,audio.play(audio.enchant,!0)),keysDown[KeyCode.R]&&!keysDown[KeyCode.CTRL]&&hero.manaKits>0&&hero.mana<hero.maxMana&&(++hero.mana,--hero.manaKits,audio.play(audio.enchant,!0))}}};class Main{constructor(){this.setCanvasGlobals(),this.loadingScreen(),hero.init(),window.audio=new GameAudio,level.init(),window.HUD=new Hud}onFontLoaded(){setInterval(()=>{++game.actualTime},1e3),game.start()}setCanvasGlobals(){window.canvas=document.querySelector(\"canvas\"),window.ctx=canvas.getContext(\"2d\"),window.FULLW=canvas.width,window.FULLH=canvas.height-game.padHUD,window.HALFW=FULLW/2,window.HALFH=FULLH/2}loadingScreen(){ctx.fillStyle=\"#e1e1e1\",ctx.font='25px \"Press Start 2P\"',ctx.fillText(\"LOADING...\",HALFW-80,HALFH+20)}debug(){\"jons-quest-jonmann20.c9users.io\"===location.hostname&&(window.DEBUG=!0,window.DEBUG_OPT={lvl:3},canvas.style.transition=\"opacity 0.01s\",lastKeyDown=KeyCode.ENTER)}}$(()=>{let e=new Main;window.WebFontConfig={google:{families:[\"Press Start 2P\"]},active:function(){e.onFontLoaded()},inactive:function(){alert(\"There was a problem loading a font from google, some text may not render correctly (refreshing the page may fix the issue).\"),e.onFontLoaded()}},(()=>{let e=document.createElement(\"script\");e.src=\"https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js\",e.type=\"text/javascript\",e.async=\"true\";let t=document.getElementsByTagName(\"script\")[0];t.parentNode.insertBefore(e,t)})()});"
  ]
}